import{B as N,q as V,r as y,c as i,a as e,d as C,t as u,F as $,i as I,b as n,w as M,h as O,n as G,u as A,f as s,e as k,m as T,y as E,j as D,D as F,z,L as W,J as Y,I as H,E as R,K as Q,g as L,_ as X}from"./index-CI5G-_d9.js";import{D as B}from"./DashboardClientAssignmentStore-BWYBZsrn.js";import{L as o}from"./localeText-CJOniz0A.js";const Z={class:"card rounded-0 border-0"},ee={role:"button",class:"ms-auto text-white"},se={key:0,class:"bi bi-chevron-compact-down"},te={key:1,class:"bi bi-chevron-compact-up"},le={key:0,class:"card-body p-0"},ne={class:"list-group list-group-flush"},ae={key:0},ie={class:"text-body"},oe={class:"text-muted"},re={key:1},de={class:"text-body"},ce={class:"text-muted"},ue=["onClick"],me=["onClick"],U=N({__name:"availablePeersGroup",props:["configuration","peers","clientAssignedPeers","availablePeerSearchString"],emits:["assign","unassign"],setup(g,{emit:S}){const r=g,_=S,m=B(),f=V(()=>r.clientAssignedPeers&&Object.keys(r.clientAssignedPeers).includes(r.configuration)?r.peers.filter(a=>!r.clientAssignedPeers[r.configuration].map(t=>t.id).includes(a.id)&&(!r.availablePeerSearchString||r.availablePeerSearchString&&(a.id.includes(r.availablePeerSearchString)||a.name.includes(r.availablePeerSearchString)))):r.availablePeerSearchString?r.peers.filter(a=>a.id.includes(r.availablePeerSearchString)||a.name.includes(r.availablePeerSearchString)):r.peers),x=y(!1),h=y(!1);return(a,t)=>{const d=O("RouterLink");return s(),i("div",Z,[e("div",{onClick:t[0]||(t[0]=l=>h.value=!h.value),role:"button",class:"card-header rounded-0 sticky-top bg-body-secondary border-0 border-bottom text-white d-flex"},[e("small",null,[e("samp",null,u(g.configuration),1)]),e("a",ee,[h.value?(s(),i("i",se)):(s(),i("i",te))])]),h.value?C("",!0):(s(),i("div",le,[e("div",ne,[(s(!0),i($,null,I(f.value,l=>(s(),i("div",{class:"list-group-item d-flex border-bottom list-group-item-action d-flex align-items-center gap-3",key:l.id},[x.value?(s(),i("div",re,[e("small",de,[n(o,{t:"Are you sure to remove this peer?"})]),t[2]||(t[2]=e("br",null,null,-1)),e("small",ce,[e("samp",null,u(l.id),1)])])):(s(),i("div",ae,[e("small",ie,[n(d,{class:"text-decoration-none",target:"_blank",to:"/configuration/"+g.configuration+"/peers?id="+encodeURIComponent(l.id)},{default:M(()=>[e("samp",null,u(l.id),1)]),_:2},1032,["to"])]),t[1]||(t[1]=e("br",null,null,-1)),e("small",oe,u(l.name?l.name:"Untitled Peer"),1)])),g.clientAssignedPeers?(s(),i("button",{key:2,onClick:b=>_("assign",l.id),class:G([{disabled:A(m).assigning},"btn bg-success-subtle text-success-emphasis ms-auto"])},[...t[3]||(t[3]=[e("i",{class:"bi bi-plus-circle-fill"},null,-1)])],10,ue)):(s(),i("button",{key:3,onClick:b=>_("unassign",l.assignment_id),class:G([{disabled:A(m).unassigning},"btn bg-danger-subtle text-danger-emphasis ms-auto"]),"aria-label":"Delete Assignment"},[...t[4]||(t[4]=[e("i",{class:"bi bi-trash-fill"},null,-1)])],10,me))]))),128))])]))])}}}),ge={key:0,class:"d-flex rounded-0 border-0 flex-column d-flex flex-column border-bottom pb-1"},be={class:"d-flex flex-column p-3 gap-3"},ve={class:"d-flex align-items-center"},_e={class:"mb-0"},fe={class:"text-bg-primary badge ms-2"},he={class:"text-bg-info badge ms-2"},pe={class:"rounded-3 availablePeers border h-100 overflow-scroll flex-grow-1 d-flex flex-column"},ye={key:0,class:"text-muted m-auto p-3"},xe={key:0,style:{height:"500px"},class:"d-flex flex-column p-3"},ke={class:"availablePeers border h-100 card rounded-3"},Ce={class:"card-header sticky-top p-3"},Pe={class:"mb-0 d-flex align-items-center"},Se={class:"card-body p-0 overflow-scroll"},$e={key:0,class:"text-muted m-auto"},we={class:"card-footer d-flex gap-2 p-3 align-items-center justify-content-end"},Ae={key:1},De=N({__name:"clientAssignedPeers",props:["client","clientAssignedPeers"],emits:["refresh"],setup(g,{emit:S}){const r=g,_=y(!1),m=B(),f=y(!1),x=S,h=async(d,l,b)=>{await m.assignClient(d,l,b,!1),x("refresh")},a=async d=>{await m.unassignClient(void 0,void 0,d),x("refresh")},t=y("");return(d,l)=>(s(),i("div",null,[_.value?(s(),i("div",Ae,[...l[6]||(l[6]=[e("div",{class:"p-3 placeholder-glow border-bottom"},[e("h6",{class:"placeholder w-100 rounded-3"}),e("div",{class:"placeholder w-100 rounded-3",style:{height:"400px"}})],-1)])])):(s(),i("div",ge,[e("div",be,[e("div",ve,[e("h6",_e,[n(o,{t:"Assigned Peers"}),e("span",fe,[k(u(Object.keys(g.clientAssignedPeers).length)+" ",1),n(o,{t:Object.keys(g.clientAssignedPeers).length>1?"Configurations":"Configuration"},null,8,["t"])]),e("span",he,[k(u(Object.values(g.clientAssignedPeers).flat().length)+" ",1),n(o,{t:Object.values(g.clientAssignedPeers).flat().length>1?"Peers":"Peer"},null,8,["t"])])]),e("button",{class:"btn btn-sm bg-primary-subtle text-primary-emphasis rounded-3 ms-auto",onClick:l[0]||(l[0]=b=>f.value=!f.value)},[f.value?(s(),i($,{key:1},[l[4]||(l[4]=e("i",{class:"bi bi-check me-2"},null,-1)),n(o,{t:"Done"})],64)):(s(),i($,{key:0},[l[3]||(l[3]=e("i",{class:"bi bi-list-check me-2"},null,-1)),n(o,{t:"Manage"})],64))])]),e("div",pe,[(s(!0),i($,null,I(g.clientAssignedPeers,(b,v)=>(s(),D(U,{configuration:v,peers:b,onUnassign:l[1]||(l[1]=async p=>await a(p))},null,8,["configuration","peers"]))),256)),Object.keys(g.clientAssignedPeers).length===0?(s(),i("h6",ye,[n(o,{t:"No peer assigned to this client"})])):C("",!0)])]),f.value?(s(),i("div",xe,[e("div",ke,[e("div",Ce,[e("h6",Pe,[n(o,{t:"Available Peers"})])]),e("div",Se,[(s(!0),i($,null,I(A(m).allConfigurationsPeers,(b,v)=>(s(),D(U,{availablePeerSearchString:t.value,configuration:v,clientAssignedPeers:g.clientAssignedPeers,peers:b,key:v,onAssign:async p=>await h(v,p,r.client.ClientID)},null,8,["availablePeerSearchString","configuration","clientAssignedPeers","peers","onAssign"]))),128)),Object.keys(A(m).allConfigurationsPeers).length===0?(s(),i("h6",$e,[n(o,{t:"No peer is available to assign"})])):C("",!0)]),e("div",we,[l[5]||(l[5]=e("label",{for:"availablePeerSearchString"},[e("i",{class:"bi bi-search me-2"})],-1)),T(e("input",{id:"availablePeerSearchString","onUpdate:modelValue":l[2]||(l[2]=b=>t.value=b),class:"form-control form-control-sm rounded-3 w-auto",type:"text"},null,512),[[E,t.value]])])])])):C("",!0)]))]))}}),Ne={class:"p-3 d-flex gap-3 flex-column border-bottom"},Ie={class:"d-flex align-items-center gap-2"},Be={class:"mb-0"},je=N({__name:"clientDelete",props:["client"],emits:["refresh"],setup(g,{emit:S}){const r=g,_=y(!1),m=y(!1),f=S,x=F(),h=async()=>{_.value=!0,await z("/api/clients/deleteClient",{ClientID:r.client.ClientID},a=>{_.value=!1,a.status?(f("deleteSuccess"),x.newMessage("Server","Delete client successfully","success")):x.newMessage("Server","Failed to delete client","danger")})};return(a,t)=>(s(),i("div",Ne,[e("div",Ie,[e("h6",Be,[m.value?(s(),D(o,{key:1,t:"Are you sure to delete this client?"})):(s(),D(o,{key:0,t:"Delete Client"}))]),m.value?C("",!0):(s(),i("button",{key:0,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto",onClick:t[0]||(t[0]=d=>m.value=!0)},[t[2]||(t[2]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),n(o,{t:"Delete"})])),m.value?(s(),i($,{key:1},[e("button",{onClick:h,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto"},[t[3]||(t[3]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),n(o,{t:"Yes"})]),m.value?(s(),i("button",{key:0,class:"btn btn-sm bg-secondary-subtle text-secondary-emphasis rounded-3",onClick:t[1]||(t[1]=d=>m.value=!1)},[t[4]||(t[4]=e("i",{class:"bi bi-x-lg me-2"},null,-1)),n(o,{t:"No"})])):C("",!0)],64)):C("",!0)])]))}}),Ge={class:"p-4 border-bottom bg-body-tertiary z-0"},Re={class:"mb-3 backLink"},Le={class:"text-muted"},Ue={class:"d-flex flex-column gap-2"},Ve={class:"d-flex align-items-center"},Me={class:"text-muted"},Oe={class:"ms-auto"},Te={class:"d-flex align-items-center gap-2"},Ee={class:"text-muted"},Fe={key:0,class:"p-3 border-bottom"},ze={class:"row g-3"},qe={class:"col-lg-4"},Je={class:"card rounded-3 h-100"},Ke={class:"card-body"},We={class:"text-muted"},Ye={class:"h4 mb-1"},He={class:"small text-muted"},Qe={class:"col-lg-4"},Xe={class:"card rounded-3 h-100"},Ze={class:"card-body"},es={class:"text-muted"},ss={class:"ms-1"},ts={class:"h4 mb-1"},ls={class:"small text-muted"},ns={class:"col-lg-4"},as={class:"card rounded-3 h-100"},is={class:"card-body"},os={class:"text-muted"},rs={class:"h4 mb-1"},ds={class:"small text-muted"},cs={key:0,class:"alert alert-warning mt-3 mb-0 py-2"},us={style:{flex:"1 0 0","overflow-y":"scroll"}},ms={key:1,class:"d-flex w-100 h-100 text-muted"},gs={class:"m-auto text-center"},bs=N({__name:"clientViewer",emits:["deleteSuccess"],async setup(g,{emit:S}){let r,_;const m=B(),f=F(),x=W(),h=Q(),a=V(()=>m.getClientById(x.params.id)),t=y({}),d=y(null),l=async()=>{await L("/api/clients/assignedPeers",{ClientID:a.value.ClientID},P=>{t.value=P.data})},b=async()=>{await L("/api/clients/usageSummary",{ClientID:a.value.ClientID},P=>{d.value=P.data})},v=Y({Name:void 0}),p=P=>{const c=Number(P);return Number.isNaN(c)?"0.000":c.toFixed(3)};a.value?(H(()=>a.value.ClientID,async()=>{v.Name=a.value.Name,await l(),await b()}),[r,_]=R(()=>l()),await r,_(),[r,_]=R(()=>b()),await r,_(),v.Name=a.value.Name):(h.push("/clients"),f.newMessage("WGDashboard","Client does not exist","danger"));const j=y(!1),q=async()=>{j.value=!0,await z("/api/clients/updateProfileName",{ClientID:a.value.ClientID,Name:v.Name},P=>{P.status?(a.value.Name=v.Name,f.newMessage("Server","Client name update success","success")):(v.Name=a.value.Name,f.newMessage("Server","Client name update failed","danger")),j.value=!1})},J=async()=>{await h.push("/clients"),await m.getClients()};return(P,c)=>{const K=O("RouterLink");return a.value?(s(),i("div",{class:"text-body d-flex flex-column overflow-y-scroll h-100",key:a.value.ClientID},[e("div",Ge,[e("div",Re,[n(K,{to:"/clients",class:"text-body text-decoration-none"},{default:M(()=>[...c[4]||(c[4]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),k(" Back",-1)])]),_:1})]),e("small",Le,[n(o,{t:"Email"})]),e("h1",null,u(a.value.Email),1),e("div",Ue,[e("div",Ve,[e("small",Me,[n(o,{t:"Client ID"})]),e("small",Oe,[e("samp",null,u(a.value.ClientID),1)])]),e("div",Te,[e("small",Ee,[n(o,{t:"Client Name"})]),T(e("input",{class:"form-control form-control-sm rounded-3 ms-auto",style:{width:"300px"},type:"text","onUpdate:modelValue":c[0]||(c[0]=w=>v.Name=w)},null,512),[[E,v.Name]]),e("button",{onClick:c[1]||(c[1]=w=>q()),"aria-label":"Save Client Name",class:"btn btn-sm rounded-3 bg-success-subtle border-success-subtle text-success-emphasis"},[...c[5]||(c[5]=[e("i",{class:"bi bi-save-fill"},null,-1)])])])])]),d.value?(s(),i("div",Fe,[e("div",ze,[e("div",qe,[e("div",Je,[e("div",Ke,[e("small",We,[n(o,{t:"Total Usage"})]),e("div",Ye,u(p(d.value.total.total_gb))+" GB",1),e("div",He,[n(o,{t:"Sent"}),k(": "+u(p(d.value.total.sent_gb))+" GB ",1),c[6]||(c[6]=e("span",{class:"mx-2"},"•",-1)),n(o,{t:"Received"}),k(": "+u(p(d.value.total.receive_gb))+" GB ",1)])])])]),e("div",Qe,[e("div",Xe,[e("div",Ze,[e("small",es,[n(o,{t:"Today"}),e("span",ss,"("+u(d.value.daily.date)+")",1)]),e("div",ts,u(p(d.value.daily.total_gb))+" GB",1),e("div",ls,[n(o,{t:"Sent"}),k(": "+u(p(d.value.daily.sent_gb))+" GB ",1),c[7]||(c[7]=e("span",{class:"mx-2"},"•",-1)),n(o,{t:"Received"}),k(": "+u(p(d.value.daily.receive_gb))+" GB ",1)])])])]),e("div",ns,[e("div",as,[e("div",is,[e("small",os,[n(o,{t:"Assigned Peers"})]),e("div",rs,u(d.value.peers_count),1),e("div",ds,[n(o,{t:"Updated"}),k(": "+u(d.value.generated_at),1)])])])])]),d.value.tracking_disabled_configurations&&d.value.tracking_disabled_configurations.length?(s(),i("div",cs,[e("small",null,[n(o,{t:"Traffic tracking disabled for"}),k(": "+u(d.value.tracking_disabled_configurations.join(", ")),1)])])):C("",!0)])):C("",!0),e("div",us,[n(De,{onRefresh:c[2]||(c[2]=w=>l()),clientAssignedPeers:t.value,client:a.value},null,8,["clientAssignedPeers","client"]),n(je,{onDeleteSuccess:c[3]||(c[3]=w=>J()),client:a.value},null,8,["client"])])])):(s(),i("div",ms,[e("div",gs,[c[8]||(c[8]=e("h1",null,[e("i",{class:"bi bi-person-x"})],-1)),e("p",null,[n(o,{t:"Client does not exist"})])])]))}}}),hs=X(bs,[["__scopeId","data-v-2ade3da3"]]);export{hs as default};

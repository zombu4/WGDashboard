import{E as T,x as te,r as _,c as o,a as e,d as C,t as r,F as M,k as V,b as t,w as se,j as le,n as Q,u as L,f as a,e as g,q as F,A as j,l as G,D as ae,B as ne,N as ce,L as ue,K as X,I as B,M as me,z as ve,g as U,_ as be}from"./index-Dml9qu0A.js";import{D as q}from"./DashboardClientAssignmentStore-Km8ARLb9.js";import{L as l}from"./localeText-DLTevZCc.js";import{S as ge}from"./sparkline-BC1KIuK7.js";import{d as R}from"./dayjs.min-DtcwAJXu.js";const _e={class:"card rounded-0 border-0"},fe={role:"button",class:"ms-auto text-white"},pe={key:0,class:"bi bi-chevron-compact-down"},he={key:1,class:"bi bi-chevron-compact-up"},ye={key:0,class:"card-body p-0"},xe={class:"list-group list-group-flush"},ke={key:0},we={class:"text-body"},Ce={class:"text-muted"},Se={key:1},De={class:"text-body"},$e={class:"text-muted"},Pe=["onClick"],Me=["onClick"],Z=T({__name:"availablePeersGroup",props:["configuration","peers","clientAssignedPeers","availablePeerSearchString"],emits:["assign","unassign"],setup(f,{emit:A}){const c=f,p=A,b=q(),x=te(()=>c.clientAssignedPeers&&Object.keys(c.clientAssignedPeers).includes(c.configuration)?c.peers.filter(i=>!c.clientAssignedPeers[c.configuration].map(d=>d.id).includes(i.id)&&(!c.availablePeerSearchString||c.availablePeerSearchString&&(i.id.includes(c.availablePeerSearchString)||i.name.includes(c.availablePeerSearchString)))):c.availablePeerSearchString?c.peers.filter(i=>i.id.includes(c.availablePeerSearchString)||i.name.includes(c.availablePeerSearchString)):c.peers),S=_(!1),k=_(!1);return(i,d)=>{const u=le("RouterLink");return a(),o("div",_e,[e("div",{onClick:d[0]||(d[0]=n=>k.value=!k.value),role:"button",class:"card-header rounded-0 sticky-top bg-body-secondary border-0 border-bottom text-white d-flex"},[e("small",null,[e("samp",null,r(f.configuration),1)]),e("a",fe,[k.value?(a(),o("i",pe)):(a(),o("i",he))])]),k.value?C("",!0):(a(),o("div",ye,[e("div",xe,[(a(!0),o(M,null,V(x.value,n=>(a(),o("div",{class:"list-group-item d-flex border-bottom list-group-item-action d-flex align-items-center gap-3",key:n.id},[S.value?(a(),o("div",Se,[e("small",De,[t(l,{t:"Are you sure to remove this peer?"})]),d[2]||(d[2]=e("br",null,null,-1)),e("small",$e,[e("samp",null,r(n.id),1)])])):(a(),o("div",ke,[e("small",we,[t(u,{class:"text-decoration-none",target:"_blank",to:"/configuration/"+f.configuration+"/peers?id="+encodeURIComponent(n.id)},{default:se(()=>[e("samp",null,r(n.id),1)]),_:2},1032,["to"])]),d[1]||(d[1]=e("br",null,null,-1)),e("small",Ce,r(n.name?n.name:"Untitled Peer"),1)])),f.clientAssignedPeers?(a(),o("button",{key:2,onClick:m=>p("assign",n.id),class:Q([{disabled:L(b).assigning},"btn bg-success-subtle text-success-emphasis ms-auto"])},[...d[3]||(d[3]=[e("i",{class:"bi bi-plus-circle-fill"},null,-1)])],10,Pe)):(a(),o("button",{key:3,onClick:m=>p("unassign",n.assignment_id),class:Q([{disabled:L(b).unassigning},"btn bg-danger-subtle text-danger-emphasis ms-auto"]),"aria-label":"Delete Assignment"},[...d[4]||(d[4]=[e("i",{class:"bi bi-trash-fill"},null,-1)])],10,Me))]))),128))])]))])}}}),Ae={key:0,class:"d-flex rounded-0 border-0 flex-column d-flex flex-column border-bottom pb-1"},Ie={class:"d-flex flex-column p-3 gap-3"},Ne={class:"d-flex align-items-center"},Re={class:"mb-0"},Ye={class:"text-bg-primary badge ms-2"},Be={class:"text-bg-info badge ms-2"},Ue={class:"rounded-3 availablePeers border h-100 overflow-scroll flex-grow-1 d-flex flex-column"},Fe={key:0,class:"text-muted m-auto p-3"},je={key:0,style:{height:"500px"},class:"d-flex flex-column p-3"},Ve={class:"availablePeers border h-100 card rounded-3"},Le={class:"card-header sticky-top p-3"},Ge={class:"mb-0 d-flex align-items-center"},Te={class:"card-body p-0 overflow-scroll"},Oe={key:0,class:"text-muted m-auto"},Ee={class:"card-footer d-flex gap-2 p-3 align-items-center justify-content-end"},ze={key:1},qe=T({__name:"clientAssignedPeers",props:["client","clientAssignedPeers"],emits:["refresh"],setup(f,{emit:A}){const c=f,p=_(!1),b=q(),x=_(!1),S=A,k=async(u,n,m)=>{await b.assignClient(u,n,m,!1),S("refresh")},i=async u=>{await b.unassignClient(void 0,void 0,u),S("refresh")},d=_("");return(u,n)=>(a(),o("div",null,[p.value?(a(),o("div",ze,[...n[6]||(n[6]=[e("div",{class:"p-3 placeholder-glow border-bottom"},[e("h6",{class:"placeholder w-100 rounded-3"}),e("div",{class:"placeholder w-100 rounded-3",style:{height:"400px"}})],-1)])])):(a(),o("div",Ae,[e("div",Ie,[e("div",Ne,[e("h6",Re,[t(l,{t:"Assigned Peers"}),e("span",Ye,[g(r(Object.keys(f.clientAssignedPeers).length)+" ",1),t(l,{t:Object.keys(f.clientAssignedPeers).length>1?"Configurations":"Configuration"},null,8,["t"])]),e("span",Be,[g(r(Object.values(f.clientAssignedPeers).flat().length)+" ",1),t(l,{t:Object.values(f.clientAssignedPeers).flat().length>1?"Peers":"Peer"},null,8,["t"])])]),e("button",{class:"btn btn-sm bg-primary-subtle text-primary-emphasis rounded-3 ms-auto",onClick:n[0]||(n[0]=m=>x.value=!x.value)},[x.value?(a(),o(M,{key:1},[n[4]||(n[4]=e("i",{class:"bi bi-check me-2"},null,-1)),t(l,{t:"Done"})],64)):(a(),o(M,{key:0},[n[3]||(n[3]=e("i",{class:"bi bi-list-check me-2"},null,-1)),t(l,{t:"Manage"})],64))])]),e("div",Ue,[(a(!0),o(M,null,V(f.clientAssignedPeers,(m,w)=>(a(),G(Z,{configuration:w,peers:m,onUnassign:n[1]||(n[1]=async y=>await i(y))},null,8,["configuration","peers"]))),256)),Object.keys(f.clientAssignedPeers).length===0?(a(),o("h6",Fe,[t(l,{t:"No peer assigned to this client"})])):C("",!0)])]),x.value?(a(),o("div",je,[e("div",Ve,[e("div",Le,[e("h6",Ge,[t(l,{t:"Available Peers"})])]),e("div",Te,[(a(!0),o(M,null,V(L(b).allConfigurationsPeers,(m,w)=>(a(),G(Z,{availablePeerSearchString:d.value,configuration:w,clientAssignedPeers:f.clientAssignedPeers,peers:m,key:w,onAssign:async y=>await k(w,y,c.client.ClientID)},null,8,["availablePeerSearchString","configuration","clientAssignedPeers","peers","onAssign"]))),128)),Object.keys(L(b).allConfigurationsPeers).length===0?(a(),o("h6",Oe,[t(l,{t:"No peer is available to assign"})])):C("",!0)]),e("div",Ee,[n[5]||(n[5]=e("label",{for:"availablePeerSearchString"},[e("i",{class:"bi bi-search me-2"})],-1)),F(e("input",{id:"availablePeerSearchString","onUpdate:modelValue":n[2]||(n[2]=m=>d.value=m),class:"form-control form-control-sm rounded-3 w-auto",type:"text"},null,512),[[j,d.value]])])])])):C("",!0)]))]))}}),He={class:"p-3 d-flex gap-3 flex-column border-bottom"},Ke={class:"d-flex align-items-center gap-2"},We={class:"mb-0"},Je=T({__name:"clientDelete",props:["client"],emits:["refresh"],setup(f,{emit:A}){const c=f,p=_(!1),b=_(!1),x=A,S=ae(),k=async()=>{p.value=!0,await ne("/api/clients/deleteClient",{ClientID:c.client.ClientID},i=>{p.value=!1,i.status?(x("deleteSuccess"),S.newMessage("Server","Delete client successfully","success")):S.newMessage("Server","Failed to delete client","danger")})};return(i,d)=>(a(),o("div",He,[e("div",Ke,[e("h6",We,[b.value?(a(),G(l,{key:1,t:"Are you sure to delete this client?"})):(a(),G(l,{key:0,t:"Delete Client"}))]),b.value?C("",!0):(a(),o("button",{key:0,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto",onClick:d[0]||(d[0]=u=>b.value=!0)},[d[2]||(d[2]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),t(l,{t:"Delete"})])),b.value?(a(),o(M,{key:1},[e("button",{onClick:k,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto"},[d[3]||(d[3]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),t(l,{t:"Yes"})]),b.value?(a(),o("button",{key:0,class:"btn btn-sm bg-secondary-subtle text-secondary-emphasis rounded-3",onClick:d[1]||(d[1]=u=>b.value=!1)},[d[4]||(d[4]=e("i",{class:"bi bi-x-lg me-2"},null,-1)),t(l,{t:"No"})])):C("",!0)],64)):C("",!0)])]))}}),Qe={class:"p-4 border-bottom bg-body-tertiary z-0"},Xe={class:"mb-3 backLink"},Ze={class:"text-muted"},et={class:"d-flex flex-column gap-2"},tt={class:"d-flex align-items-center"},st={class:"text-muted"},lt={class:"ms-auto"},at={class:"d-flex align-items-center gap-2"},nt={class:"text-muted"},it={key:0,class:"p-3 border-bottom"},ot={class:"d-flex justify-content-end align-items-center gap-2 mb-2"},dt={class:"text-muted"},rt=["selected"],ct=["selected"],ut={class:"row g-3"},mt={class:"col-lg-3"},vt={class:"card rounded-3 h-100"},bt={class:"card-body"},gt={class:"text-muted"},_t={class:"h4 mb-1"},ft={class:"small text-muted"},pt={class:"col-lg-3"},ht={class:"card rounded-3 h-100"},yt={class:"card-body"},xt={class:"text-muted"},kt={class:"ms-1"},wt={class:"h4 mb-1"},Ct={class:"small text-muted"},St={class:"col-lg-3"},Dt={class:"card rounded-3 h-100"},$t={class:"card-body"},Pt={class:"text-muted"},Mt={class:"h4 mb-1"},At={class:"small text-muted"},It={class:"col-lg-3"},Nt={class:"card rounded-3 h-100"},Rt={class:"card-body"},Yt={class:"text-muted"},Bt={class:"h5 mb-1"},Ut={class:"h6 text-muted mb-0"},Ft={class:"mt-2"},jt={class:"small text-muted mt-1"},Vt={key:0,class:"alert alert-warning mt-3 mb-0 py-2"},Lt={key:1,class:"p-3 border-bottom"},Gt={class:"d-flex align-items-center gap-2 mb-2"},Tt={class:"text-muted mb-0"},Ot={class:"d-flex flex-wrap gap-2 mb-3"},Et={class:"form-label text-muted mb-1"},zt={class:"form-label text-muted mb-1"},qt={class:"ms-auto"},Ht={class:"form-label text-muted mb-1"},Kt={class:"small"},Wt={class:"text-muted ms-2"},Jt={class:"table-responsive"},Qt={class:"table table-sm table-striped align-middle"},Xt={key:0,class:"alert alert-warning mt-2 mb-0 py-2"},Zt={style:{flex:"1 0 0","overflow-y":"scroll"}},es={key:1,class:"d-flex w-100 h-100 text-muted"},ts={class:"m-auto text-center"},ee=30,ss=T({__name:"clientViewer",emits:["deleteSuccess"],async setup(f,{emit:A}){let c,p;const b=q(),x=ae(),S=ce(),k=me(),i=te(()=>b.getClientById(S.params.id)),d=_({}),u=_(null),n=_({sent_bps:0,recv_bps:0,updated_at:null}),m=_({sent:[],recv:[]}),w=_(window.localStorage.getItem("wgdashboard_rate_unit")||"Mbps"),y=_(null),D=_(R().subtract(6,"day").format("YYYY-MM-DD")),$=_(R().format("YYYY-MM-DD")),O=async()=>{await U("/api/clients/assignedPeers",{ClientID:i.value.ClientID},v=>{d.value=v.data})},H=async()=>{await U("/api/clients/usageSummary",{ClientID:i.value.ClientID},v=>{u.value=v.data})},E=async()=>{await U("/api/clients/realtimeUsage",{ClientID:i.value.ClientID},v=>{n.value=v.data||{sent_bps:0,recv_bps:0,updated_at:null};const s=Number(n.value.sent_bps||0),N=Number(n.value.recv_bps||0);m.value.sent.push(s),m.value.recv.push(N),m.value.sent.length>ee&&m.value.sent.shift(),m.value.recv.length>ee&&m.value.recv.shift()})},z=async()=>{await U("/api/clients/usageReport",{ClientID:i.value.ClientID,startDate:D.value,endDate:$.value},v=>{y.value=v.data||null})},P=ue({Name:void 0}),I=v=>{const s=Number(v);if(!Number.isFinite(s))return"0 MB";const N=Math.abs(s);return N>=1024?`${(s/1024).toFixed(2)} TB`:N>=1?`${s.toFixed(2)} GB`:`${(s*1024).toFixed(2)} MB`},K=v=>{const s=Number(v||0);return w.value==="MB/s"?`${(s/1e6).toFixed(2)} MB/s`:`${(s*8/1e6).toFixed(2)} Mbps`},ie=v=>{w.value=v.target.value,window.localStorage.setItem("wgdashboard_rate_unit",w.value)},W=v=>{D.value=R().subtract(v-1,"day").format("YYYY-MM-DD"),$.value=R().format("YYYY-MM-DD")},oe=()=>{const v=`/api/clients/usageReportCSV?ClientID=${i.value.ClientID}&startDate=${D.value}&endDate=${$.value}`;window.open(v,"_blank")};i.value?(X(()=>i.value.ClientID,async()=>{m.value={sent:[],recv:[]},D.value=R().subtract(6,"day").format("YYYY-MM-DD"),$.value=R().format("YYYY-MM-DD"),P.Name=i.value.Name,await O(),await H(),await E(),await z()}),[c,p]=B(()=>O()),await c,p(),[c,p]=B(()=>H()),await c,p(),[c,p]=B(()=>E()),await c,p(),[c,p]=B(()=>z()),await c,p(),P.Name=i.value.Name):(k.push("/clients"),x.newMessage("WGDashboard","Client does not exist","danger"));const J=_(!1),de=async()=>{J.value=!0,await ne("/api/clients/updateProfileName",{ClientID:i.value.ClientID,Name:P.Name},v=>{v.status?(i.value.Name=P.Name,x.newMessage("Server","Client name update success","success")):(P.Name=i.value.Name,x.newMessage("Server","Client name update failed","danger")),J.value=!1})},re=async()=>{await k.push("/clients"),await b.getClients()},Y=_(void 0);return clearInterval(Y.value),Y.value=setInterval(async()=>{await E()},5e3),ve(()=>{clearInterval(Y.value),Y.value=void 0}),X([D,$],async()=>{i.value&&await z()}),(v,s)=>{const N=le("RouterLink");return i.value?(a(),o("div",{class:"text-body d-flex flex-column overflow-y-scroll h-100",key:i.value.ClientID},[e("div",Qe,[e("div",Xe,[t(N,{to:"/clients",class:"text-body text-decoration-none"},{default:se(()=>[...s[8]||(s[8]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),g(" Back",-1)])]),_:1})]),e("small",Ze,[t(l,{t:"Email"})]),e("h1",null,r(i.value.Email),1),e("div",et,[e("div",tt,[e("small",st,[t(l,{t:"Client ID"})]),e("small",lt,[e("samp",null,r(i.value.ClientID),1)])]),e("div",at,[e("small",nt,[t(l,{t:"Client Name"})]),F(e("input",{class:"form-control form-control-sm rounded-3 ms-auto",style:{width:"300px"},type:"text","onUpdate:modelValue":s[0]||(s[0]=h=>P.Name=h)},null,512),[[j,P.Name]]),e("button",{onClick:s[1]||(s[1]=h=>de()),"aria-label":"Save Client Name",class:"btn btn-sm rounded-3 bg-success-subtle border-success-subtle text-success-emphasis"},[...s[9]||(s[9]=[e("i",{class:"bi bi-save-fill"},null,-1)])])])])]),u.value?(a(),o("div",it,[e("div",ot,[e("small",dt,[t(l,{t:"Realtime Units"})]),e("select",{class:"form-select form-select-sm w-auto",onChange:ie},[e("option",{value:"Mbps",selected:w.value==="Mbps"},"Mbps",8,rt),e("option",{value:"MB/s",selected:w.value==="MB/s"},"MB/s",8,ct)],32)]),e("div",ut,[e("div",mt,[e("div",vt,[e("div",bt,[e("small",gt,[t(l,{t:"Total Usage"})]),e("div",_t,r(I(u.value.total.total_gb)),1),e("div",ft,[t(l,{t:"Sent"}),g(": "+r(I(u.value.total.sent_gb))+" ",1),s[10]||(s[10]=e("span",{class:"mx-2"},"•",-1)),t(l,{t:"Received"}),g(": "+r(I(u.value.total.receive_gb)),1)])])])]),e("div",pt,[e("div",ht,[e("div",yt,[e("small",xt,[t(l,{t:"Today"}),e("span",kt,"("+r(u.value.daily.date)+")",1)]),e("div",wt,r(I(u.value.daily.total_gb)),1),e("div",Ct,[t(l,{t:"Sent"}),g(": "+r(I(u.value.daily.sent_gb))+" ",1),s[11]||(s[11]=e("span",{class:"mx-2"},"•",-1)),t(l,{t:"Received"}),g(": "+r(I(u.value.daily.receive_gb)),1)])])])]),e("div",St,[e("div",Dt,[e("div",$t,[e("small",Pt,[t(l,{t:"Assigned Peers"})]),e("div",Mt,r(u.value.peers_count),1),e("div",At,[t(l,{t:"Updated"}),g(": "+r(u.value.generated_at),1)])])])]),e("div",It,[e("div",Nt,[e("div",Rt,[e("small",Yt,[t(l,{t:"Realtime Speed"})]),e("div",Bt,r(K(n.value.recv_bps))+" ↓ ",1),e("div",Ut,r(K(n.value.sent_bps))+" ↑ ",1),e("div",Ft,[t(ge,{recv:m.value.recv,sent:m.value.sent,width:160,height:34},null,8,["recv","sent"])]),e("div",jt,[t(l,{t:"Updated"}),g(": "+r(n.value.updated_at||"—"),1)])])])])]),u.value.tracking_disabled_configurations&&u.value.tracking_disabled_configurations.length?(a(),o("div",Vt,[e("small",null,[t(l,{t:"Traffic tracking disabled for"}),g(": "+r(u.value.tracking_disabled_configurations.join(", ")),1)])])):C("",!0)])):C("",!0),y.value?(a(),o("div",Lt,[e("div",Gt,[e("h6",Tt,[t(l,{t:"Usage Report"})]),e("button",{class:"btn btn-sm btn-outline-secondary ms-auto",onClick:s[2]||(s[2]=h=>W(7))},[t(l,{t:"Last 7 Days"})]),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:s[3]||(s[3]=h=>W(30))},[t(l,{t:"Last 30 Days"})]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:oe},[t(l,{t:"Download CSV"})])]),e("div",Ot,[e("div",null,[e("label",Et,[e("small",null,[t(l,{t:"Start Date"})])]),F(e("input",{type:"date",class:"form-control form-control-sm","onUpdate:modelValue":s[4]||(s[4]=h=>D.value=h)},null,512),[[j,D.value]])]),e("div",null,[e("label",zt,[e("small",null,[t(l,{t:"End Date"})])]),F(e("input",{type:"date",class:"form-control form-control-sm","onUpdate:modelValue":s[5]||(s[5]=h=>$.value=h)},null,512),[[j,$.value]])]),e("div",qt,[e("label",Ht,[e("small",null,[t(l,{t:"Range Total"})])]),e("div",Kt,[e("strong",null,r((y.value.total.total_gb||0).toFixed(4)),1),s[12]||(s[12]=g(" GB ",-1)),e("span",Wt,[t(l,{t:"Sent"}),g(": "+r((y.value.total.sent_gb||0).toFixed(4))+" GB • ",1),t(l,{t:"Received"}),g(": "+r((y.value.total.receive_gb||0).toFixed(4))+" GB ",1)])])])]),e("div",Jt,[e("table",Qt,[e("thead",null,[e("tr",null,[e("th",null,[t(l,{t:"Date"})]),e("th",null,[t(l,{t:"Total"}),s[13]||(s[13]=g(" (GB)",-1))]),e("th",null,[t(l,{t:"Sent"}),s[14]||(s[14]=g(" (GB)",-1))]),e("th",null,[t(l,{t:"Received"}),s[15]||(s[15]=g(" (GB)",-1))])])]),e("tbody",null,[(a(!0),o(M,null,V(y.value.daily,h=>(a(),o("tr",{key:h.date},[e("td",null,r(h.date),1),e("td",null,r((h.total_gb||0).toFixed(4)),1),e("td",null,r((h.sent_gb||0).toFixed(4)),1),e("td",null,r((h.receive_gb||0).toFixed(4)),1)]))),128))])])]),y.value.tracking_disabled_configurations&&y.value.tracking_disabled_configurations.length?(a(),o("div",Xt,[e("small",null,[t(l,{t:"Traffic tracking disabled for"}),g(": "+r(y.value.tracking_disabled_configurations.join(", ")),1)])])):C("",!0)])):C("",!0),e("div",Zt,[t(qe,{onRefresh:s[6]||(s[6]=h=>O()),clientAssignedPeers:d.value,client:i.value},null,8,["clientAssignedPeers","client"]),t(Je,{onDeleteSuccess:s[7]||(s[7]=h=>re()),client:i.value},null,8,["client"])])])):(a(),o("div",es,[e("div",ts,[s[16]||(s[16]=e("h1",null,[e("i",{class:"bi bi-person-x"})],-1)),e("p",null,[t(l,{t:"Client does not exist"})])])]))}}}),rs=be(ss,[["__scopeId","data-v-f5aff7e4"]]);export{rs as default};

import{_ as B,r as y,I as H,K as N,c as u,f as o,a as e,d as k,t as M,e as L,b as l,n as w,B as P,g as Y,D as j,L as U,j as S,q as _,A as C,u as $,G as D,v as W,w as T,y as A,l as x,S as R,i as O,h as q}from"./index-0VWcUCvJ.js";import{d as E}from"./dayjs.min-Coib1ift.js";import{Z as J}from"./vue-datepicker--n25kRF1.js";import{L as b}from"./localeText-B67VTq1q.js";import"./index-SERM3hma.js";const G={class:"card rounded-0 border-start-0 border-bottom-0 bg-body-secondary",style:{height:"400px",overflow:"scroll"}},z={class:"card-body"},Z={key:0,class:"alert alert-danger rounded-3"},F={class:"font-monospace"},K={key:0},Q=["innerText"],X={__name:"peerShareWithEmailBodyPreview",props:["email","selectedPeer"],async setup(s){let t,v;const h=s,d=y(""),p=y(!1),r=y(""),n=async()=>{h.email&&(p.value=!1,await P("/api/email/preview",{Subject:h.email.Subject,Body:h.email.Body,ConfigurationName:h.selectedPeer.configuration.Name,Peer:h.selectedPeer.id},i=>{i.status?d.value=i.data:(d.value="",r.value=i.message),p.value=!i.status}))};[t,v]=H(()=>n()),await t,v();let c;return N(()=>h.email,async()=>{c===void 0?c=setTimeout(async()=>{await n()},500):(clearTimeout(c),c=setTimeout(async()=>{await n()},500))},{deep:!0}),(i,f)=>(o(),u("div",G,[e("div",z,[p.value&&s.email.Body?(o(),u("div",Z,[f[0]||(f[0]=e("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),e("span",F,M(r.value),1)])):k("",!0),e("div",null,[d.value?(o(),u("div",K,[e("strong",null,[l(b,{t:"Subject"}),f[1]||(f[1]=L(": ",-1))]),L(M(d.value.Subject),1)])):k("",!0),f[2]||(f[2]=e("hr",null,null,-1)),e("div",{class:w({"opacity-50":p.value}),innerText:d.value.Body},null,10,Q)])])]))}},ee=B(X,[["__scopeId","data-v-1a7765d4"]]),te={key:0},se={class:"d-flex mb-3 align-items-center"},ae={class:"mb-0 ms-auto"},ie={class:"position-relative"},oe=["disabled","placeholder"],le={class:"position-relative"},re=["placeholder","disabled"],ne={class:"row g-0"},de=["disabled","placeholder"],ce={key:0,class:"col-6"},ue={class:"card border-top-0 rounded-top-0 rounded-bottom-3 bg-body-tertiary",style:{border:"var(--bs-border-width) solid var(--bs-border-color)"}},me={class:"card-body d-flex flex-column gap-2"},he={class:"form-check form-switch ms-auto"},pe={class:"form-check-label",for:"livePreview"},be={class:"form-check form-switch"},fe={class:"form-check-label",for:"includeAttachment"},ve=["disabled"],ye={key:0},ge={key:1},_e={key:1},xe={__name:"peerShareWithEmail",props:["dataCopy","selectedPeer"],emits:["fullscreen","hide"],async setup(s,{emit:t}){let v,h;const d=s,p=y(!1);[v,h]=H(()=>Y("/api/email/ready",{},g=>{p.value=g.status})),await v,h();const r=j(),n=U({Receiver:"",Body:r.Configuration.Email.email_template,Subject:"",IncludeAttachment:!1,ConfigurationName:d.selectedPeer.configuration.Name,Peer:d.selectedPeer.id}),c=y(!1),i=y(!1),f=async()=>{i.value=!0,await P("/api/email/send",n,g=>{g.status?r.newMessage("Server","Email sent successfully!","success"):r.newMessage("Server",`Email sent failed! Reason: ${g.message}`,"danger"),i.value=!1})},V=t;return N(c,()=>{V("fullscreen",c.value)}),(g,a)=>{const I=S("RouterLink");return p.value?(o(),u("div",te,[e("div",se,[e("a",{role:"button",class:"d-flex text-decoration-none text-body text-muted",onClick:a[0]||(a[0]=m=>V("hide"))},[...a[7]||(a[7]=[e("i",{class:"bi bi-chevron-left me-2"},null,-1),L(" Back ",-1)])]),e("h6",ae,[l(b,{t:"Share with Email"})])]),e("form",{class:"d-flex gap-3 flex-column",onSubmit:a[6]||(a[6]=m=>{m.preventDefault(),f()})},[e("div",null,[e("div",ie,[a[8]||(a[8]=e("i",{class:"bi bi-person-circle",style:{position:"absolute",top:"0.4rem",left:"0.75rem"}},null,-1)),_(e("input",{type:"email",class:"form-control rounded-top-3 rounded-bottom-0",style:{"padding-left":"calc( 0.75rem + 24px )"},"onUpdate:modelValue":a[1]||(a[1]=m=>n.Receiver=m),disabled:i.value,placeholder:$(D)("Who are you sending to?"),required:"",id:"email_receiver","aria-describedby":"emailHelp"},null,8,oe),[[C,n.Receiver]])]),e("div",le,[a[9]||(a[9]=e("i",{class:"bi bi-hash",style:{position:"absolute",top:"0.4rem",left:"0.75rem"}},null,-1)),_(e("input",{type:"text",class:"form-control rounded-0 border-top-0 border-bottom-0",style:{"padding-left":"calc( 0.75rem + 24px )"},placeholder:$(D)("What's the subject?"),disabled:i.value,"onUpdate:modelValue":a[2]||(a[2]=m=>n.Subject=m),id:"email_subject","aria-describedby":"emailHelp"},null,8,re),[[C,n.Subject]])]),e("div",ne,[e("div",{class:w([c.value?"col-6":"col-12"])},[_(e("textarea",{class:"form-control rounded-top-0 rounded-bottom-0 font-monospace border-bottom-0","onUpdate:modelValue":a[3]||(a[3]=m=>n.Body=m),disabled:i.value,placeholder:$(D)("What's the body?"),style:{height:"400px","max-height":"400px"}},null,8,de),[[C,n.Body]])],2),c.value?(o(),u("div",ce,[l(ee,{email:n,selectedPeer:s.selectedPeer},null,8,["email","selectedPeer"])])):k("",!0)]),e("div",ue,[e("div",me,[e("div",he,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[4]||(a[4]=m=>c.value=m),role:"switch",id:"livePreview"},null,512),[[W,c.value]]),e("label",pe,[l(b,{t:"Live Preview"})])])])])]),e("div",be,[_(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[5]||(a[5]=m=>n.IncludeAttachment=m),role:"switch",id:"includeAttachment"},null,512),[[W,n.IncludeAttachment]]),e("label",fe,[l(b,{t:"Include configuration file as an attachment"})])]),e("button",{disabled:i.value,class:"btn bg-primary-subtle text-primary-emphasis border-primary-subtle rounded-3"},[i.value?(o(),u("span",ge,[a[11]||(a[11]=e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1)),l(b,{t:"Sending..."})])):(o(),u("span",ye,[a[10]||(a[10]=e("i",{class:"bi bi-send me-2"},null,-1)),l(b,{t:"Send"})]))],8,ve)],32)])):(o(),u("div",_e,[e("small",null,[l(b,{t:"SMTP is not configured, please navigate to "}),l(I,{to:"/settings"},{default:T(()=>[l(b,{t:"Settings"})]),_:1}),l(b,{t:" to finish setup"})])]))}}},Se=B(xe,[["__scopeId","data-v-01e380d2"]]),ke={name:"peerShareLinkModal",props:{selectedPeer:Object},components:{PeerShareWithEmail:Se,LocaleText:b,VueDatePicker:J},data(){return{dataCopy:void 0,loading:!1,fullscreen:!1,shareWithEmail:!1}},setup(){return{store:j()}},computed:{isDark(){return q(this.store.Configuration.Server.dashboard_theme)==="dark"}},mounted(){O(),this.dataCopy=JSON.parse(JSON.stringify(this.selectedPeer.ShareLink)).at(0)},watch:{"selectedPeer.ShareLink":{deep:!0,handler(s,t){t.length!==s.length&&(this.dataCopy=JSON.parse(JSON.stringify(this.selectedPeer.ShareLink)).at(0))}}},methods:{startSharing(){this.loading=!0,P("/api/sharePeer/create",{Configuration:this.selectedPeer.configuration.Name,Peer:this.selectedPeer.id,ExpireDate:E().add(7,"d").format("YYYY-MM-DD HH:mm:ss")},s=>{s.status?(this.selectedPeer.ShareLink=s.data,this.dataCopy=s.data.at(0)):this.store.newMessage("Server","Share link failed to create. Reason: "+s.message,"danger"),this.loading=!1})},updateLinkExpireDate(){P("/api/sharePeer/update",this.dataCopy,s=>{s.status?(this.dataCopy=s.data.at(0),this.selectedPeer.ShareLink=s.data,this.store.newMessage("Server","Link expire date updated","success")):this.store.newMessage("Server","Link expire date failed to update. Reason: "+s.message,"danger"),this.loading=!1})},stopSharing(){this.loading=!0,this.dataCopy.ExpireDate=E().format("YYYY-MM-DD HH:mm:ss"),this.updateLinkExpireDate()},parseTime(s){s?this.dataCopy.ExpireDate=E(s).format("YYYY-MM-DD HH:mm:ss"):this.dataCopy.ExpireDate=void 0,this.updateLinkExpireDate()}},computed:{getUrl(){const s=this.store.getActiveCrossServer();return s?`${s.host}/${this.$router.resolve({path:"/share",query:{ShareID:this.dataCopy.ShareID}}).href}`:window.location.origin+window.location.pathname+this.$router.resolve({path:"/share",query:{ShareID:this.dataCopy.ShareID}}).href}}},we={class:"peerSettingContainer w-100 h-100 position-absolute top-0 start-0 overflow-y-scroll"},Pe={class:"container d-flex h-100 w-100"},Ce={class:"card rounded-3 shadow flex-grow-1"},$e={class:"card-header bg-transparent d-flex align-items-center gap-2 border-0 p-4"},De={class:"mb-0"},Ee={key:0,class:"card-body px-4 pb-4"},Me={key:0},Le={class:"mb-3 text-muted"},Te=["disabled"],Be={key:1},Ve={key:0},We={class:"d-flex gap-2 mb-4"},He=["href"],Ne={class:"d-flex flex-column gap-2 mb-3"},je={class:"d-flex gap-2 flex-column flex-sm-row"},Ie=["disabled"],Ye={class:"text-muted"};function Ue(s,t,v,h,d,p){const r=S("LocaleText"),n=S("VueDatePicker"),c=S("PeerShareWithEmail");return o(),u("div",we,[e("div",Pe,[e("div",{class:"m-auto modal-dialog-centered dashboardModal",style:A([this.fullscreen?"width: 100%":"width: 700px"])},[e("div",Ce,[e("div",$e,[e("h4",De,[l(r,{t:"Share Peer"})]),e("button",{type:"button",class:"btn-close ms-auto",onClick:t[0]||(t[0]=i=>this.$emit("close"))})]),this.selectedPeer.ShareLink?(o(),u("div",Ee,[this.dataCopy?(o(),u("div",Be,[d.shareWithEmail?(o(),x(R,{key:1},{fallback:T(()=>[e("h6",Ye,[t[11]||(t[11]=e("span",{class:"spinner-border me-2 spinner-border-sm",role:"status"},null,-1)),l(r,{t:"Checking SMTP Configuration..."})])]),default:T(()=>[l(c,{onHide:t[4]||(t[4]=i=>d.shareWithEmail=!1),onFullscreen:t[5]||(t[5]=i=>{this.fullscreen=i}),selectedPeer:v.selectedPeer,dataCopy:d.dataCopy},null,8,["selectedPeer","dataCopy"])]),_:1})):(o(),u("div",Ve,[e("div",We,[t[7]||(t[7]=e("i",{class:"bi bi-link-45deg"},null,-1)),e("a",{href:this.getUrl,class:"text-decoration-none",target:"_blank"},M(p.getUrl),9,He)]),e("div",Ne,[e("small",null,[t[8]||(t[8]=e("i",{class:"bi bi-calendar me-2"},null,-1)),l(r,{t:"Expire At"})]),l(n,{is24:!0,"min-date":new Date,"model-value":this.dataCopy.ExpireDate,"onUpdate:modelValue":this.parseTime,"time-picker-inline":"",format:"yyyy-MM-dd HH:mm:ss","preview-format":"yyyy-MM-dd HH:mm:ss",dark:p.isDark},null,8,["min-date","model-value","onUpdate:modelValue","dark"])]),e("div",je,[e("button",{style:{flex:"1 1 0"},onClick:t[2]||(t[2]=i=>this.stopSharing()),disabled:this.loading,class:"w-100 btn bg-danger-subtle text-danger-emphasis border-1 border-danger-subtle rounded-3 shadow-sm"},[e("span",{class:w({"animate__animated animate__flash animate__infinite animate__slower":this.loading})},[...t[9]||(t[9]=[e("i",{class:"bi bi-send-slash-fill me-2"},null,-1)])],2),this.loading?(o(),x(r,{key:0,t:"Stop Sharing..."})):(o(),x(r,{key:1,t:"Stop Sharing"}))],8,Ie),e("button",{style:{flex:"1 1 0"},onClick:t[3]||(t[3]=i=>d.shareWithEmail=!0),class:"btn bg-primary-subtle text-primary-emphasis border-primary-subtle rounded-3"},[t[10]||(t[10]=e("i",{class:"bi bi-envelope me-2"},null,-1)),l(r,{t:"Share with Email"})])])]))])):(o(),u("div",Me,[e("h6",Le,[l(r,{t:"Currently the peer is not sharing"})]),e("button",{onClick:t[1]||(t[1]=i=>this.startSharing()),disabled:this.loading,class:"w-100 btn bg-success-subtle text-success-emphasis border-1 border-success-subtle rounded-3 shadow-sm"},[e("span",{class:w({"animate__animated animate__flash animate__infinite animate__slower":this.loading})},[...t[6]||(t[6]=[e("i",{class:"bi bi-send-fill me-2"},null,-1)])],2),this.loading?(o(),x(r,{key:0,t:"Sharing..."})):(o(),x(r,{key:1,t:"Start Sharing"}))],8,Te)]))])):k("",!0)])],4)])])}const Ge=B(ke,[["render",Ue]]);export{Ge as default};

import{_ as y,c as r,f as d,a as s,t as p,n as g,d as v,F as j,k,B as _,i as S,h as x,r as h,D,j as b,b as n,l as $,q as J,A as C,e as m}from"./index-2yZR85cE.js";import{Z as V}from"./vue-datepicker-DuPbLXQx.js";import{d as O}from"./dayjs.min-XlxVhpVN.js";import{L as M}from"./localeText-DUwuOj1w.js";const T={name:"scheduleDropdown",props:{options:Array,data:String,edit:!1},setup(t){t.data===void 0&&this.$emit("update",this.options[0].value)},computed:{currentSelection(){return this.options.find(t=>t.value===this.data)}}},N={class:"dropdown scheduleDropdown"},P={class:"dropdown-menu rounded-3 shadow",style:{"font-size":"0.875rem"}},A=["onClick"],F={class:"pe-5"},L={key:0,class:"bi bi-check ms-auto"};function E(t,e,l,o,c,f){return d(),r("div",N,[s("button",{class:g(["btn btn-sm btn-outline-primary rounded-3",{"disabled border-transparent":!l.edit}]),type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[s("samp",null,p(this.currentSelection.display),1)],2),s("ul",P,[l.edit?(d(!0),r(j,{key:0},k(this.options,a=>(d(),r("li",null,[s("a",{class:"dropdown-item d-flex align-items-center",role:"button",onClick:u=>t.$emit("update",a.value)},[s("samp",F,p(a.display),1),a.value===this.currentSelection.value?(d(),r("i",L)):v("",!0)],8,A)]))),256)):v("",!0)])])}const U=y(T,[["render",E],["__scopeId","data-v-abe2acbc"]]),H={name:"schedulePeerJob",components:{LocaleText:M,VueDatePicker:V,ScheduleDropdown:U},props:{dropdowns:Array[Object],pjob:Object,viewOnly:!1},setup(t){const e=h({}),l=h(!1),o=h(!1);e.value=JSON.parse(JSON.stringify(t.pjob)),e.value.CreationDate||(l.value=!0,o.value=!0);const c=D();return{job:e,edit:l,newJob:o,store:c}},data(){return{inputType:void 0}},computed:{isDark(){return x(this.store.Configuration.Server.dashboard_theme)==="dark"}},mounted(){S()},watch:{pjob:{deep:!0,immediate:!0,handler(t){this.edit||(this.job=JSON.parse(JSON.stringify(t)))}}},methods:{save(){this.job.Field&&this.job.Operator&&this.job.Action&&this.job.Value?_("/api/savePeerScheduleJob",{Job:this.job},t=>{t.status?(this.edit=!1,this.store.newMessage("Server","Peer job saved","success"),console.log(t.data),this.$emit("refresh",t.data[0]),this.newJob=!1):this.store.newMessage("Server",t.message,"danger")}):this.alert()},alert(){let t="animate__flash",e=this.$el.querySelectorAll(".scheduleDropdown"),l=this.$el.querySelectorAll("input");e.forEach(o=>o.classList.add("animate__animated",t)),l.forEach(o=>o.classList.add("animate__animated",t)),setTimeout(()=>{e.forEach(o=>o.classList.remove("animate__animated",t)),l.forEach(o=>o.classList.remove("animate__animated",t))},2e3)},reset(){this.job.CreationDate?(this.job=JSON.parse(JSON.stringify(this.pjob)),this.edit=!1):this.$emit("delete")},delete(){this.job.CreationDate&&_("/api/deletePeerScheduleJob",{Job:this.job},t=>{t.status?this.store.newMessage("Server","Peer job deleted","success"):(this.store.newMessage("Server",t.message,"danger"),this.$emit("delete"))}),this.$emit("delete")},parseTime(t){t&&(this.job.Value=O(t).format("YYYY-MM-DD HH:mm:ss"))}}},B={class:"card-header bg-transparent text-muted border-0"},I={key:0,class:"d-flex"},Y={class:"me-auto"},q={key:1},z={class:"badge text-bg-warning"},Z={class:"card-body pt-1",style:{"font-family":"var(--bs-font-monospace)"}},W={class:"d-flex gap-2 align-items-center mb-2"},G=["disabled"],K={class:"px-5 d-flex gap-2 align-items-center"},Q={class:"d-flex gap-3"},R={key:0,class:"ms-auto d-flex gap-3"},X={key:1,class:"ms-auto d-flex gap-3"};function ee(t,e,l,o,c,f){const a=b("LocaleText"),u=b("ScheduleDropdown"),w=b("VueDatePicker");return d(),r("div",{class:g(["card shadow-sm rounded-3 mb-2",{"border-warning-subtle":this.newJob}])},[s("div",B,[this.newJob?(d(),r("small",q,[s("span",z,[n(a,{t:"Unsaved Job"})])])):(d(),r("small",I,[s("strong",Y,[n(a,{t:"Job ID"})]),s("samp",null,p(this.job.JobID),1)]))]),s("div",Z,[s("div",W,[s("samp",null,[n(a,{t:"if"})]),n(u,{edit:o.edit,options:this.dropdowns.Field,data:this.job.Field,onUpdate:e[0]||(e[0]=i=>{this.job.Field=i})},null,8,["edit","options","data"]),s("samp",null,[n(a,{t:"is"})]),n(u,{edit:o.edit,options:this.dropdowns.Operator,data:this.job.Operator,onUpdate:e[1]||(e[1]=i=>this.job.Operator=i)},null,8,["edit","options","data"]),this.job.Field==="date"?(d(),$(w,{key:0,is24:!0,"min-date":new Date,"model-value":this.job.Value,"onUpdate:modelValue":this.parseTime,"time-picker-inline":"",format:"yyyy-MM-dd HH:mm:ss","preview-format":"yyyy-MM-dd HH:mm:ss",clearable:!1,disabled:!o.edit,dark:f.isDark},null,8,["min-date","model-value","onUpdate:modelValue","disabled","dark"])):J((d(),r("input",{key:1,class:"form-control form-control-sm form-control-dark rounded-3 flex-grow-1",disabled:!o.edit,"onUpdate:modelValue":e[2]||(e[2]=i=>this.job.Value=i),style:{width:"auto"}},null,8,G)),[[C,this.job.Value]]),s("samp",null,p(this.dropdowns.Field.find(i=>i.value===this.job.Field)?.unit)+" { ",1)]),s("div",K,[s("samp",null,[n(a,{t:"then"})]),n(u,{edit:o.edit,options:this.dropdowns.Action,data:this.job.Action,onUpdate:e[3]||(e[3]=i=>this.job.Action=i)},null,8,["edit","options","data"])]),s("div",Q,[e[12]||(e[12]=s("samp",null,"}",-1)),this.edit?(d(),r("div",X,[s("a",{role:"button",class:"text-secondary text-decoration-none",onClick:e[6]||(e[6]=i=>this.reset())},[e[10]||(e[10]=m("[C] ",-1)),n(a,{t:"Cancel"})]),s("a",{role:"button",class:"text-primary ms-auto text-decoration-none",onClick:e[7]||(e[7]=i=>this.save())},[e[11]||(e[11]=m("[S] ",-1)),n(a,{t:"Save"})])])):(d(),r("div",R,[s("a",{role:"button",class:"ms-auto text-decoration-none",onClick:e[4]||(e[4]=i=>this.edit=!0)},[e[8]||(e[8]=m("[E] ",-1)),n(a,{t:"Edit"})]),s("a",{role:"button",onClick:e[5]||(e[5]=i=>this.delete()),class:"text-danger text-decoration-none"},[e[9]||(e[9]=m("[D] ",-1)),n(a,{t:"Delete"})])]))])])],2)}const ie=y(H,[["render",ee],["__scopeId","data-v-50d085f8"]]);export{ie as S,U as a};

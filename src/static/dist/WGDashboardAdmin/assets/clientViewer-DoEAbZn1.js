import{E as R,x as z,r as f,c as o,a as e,d as w,t as u,F as A,k as L,b as s,w as q,j as K,n as E,u as M,f as t,e as x,q as W,A as Y,l as B,D as H,B as J,N as ee,L as se,K as te,I as j,M as le,z as ae,g as F,_ as ne}from"./index-BxUmuwM2.js";import{D as V}from"./DashboardClientAssignmentStore-DP2_XSXR.js";import{L as n}from"./localeText-DE_4BrO4.js";const ie={class:"card rounded-0 border-0"},oe={role:"button",class:"ms-auto text-white"},de={key:0,class:"bi bi-chevron-compact-down"},re={key:1,class:"bi bi-chevron-compact-up"},ce={key:0,class:"card-body p-0"},ue={class:"list-group list-group-flush"},me={key:0},ve={class:"text-body"},be={class:"text-muted"},ge={key:1},_e={class:"text-body"},fe={class:"text-muted"},he=["onClick"],pe=["onClick"],G=R({__name:"availablePeersGroup",props:["configuration","peers","clientAssignedPeers","availablePeerSearchString"],emits:["assign","unassign"],setup(v,{emit:S}){const r=v,g=S,m=V(),h=z(()=>r.clientAssignedPeers&&Object.keys(r.clientAssignedPeers).includes(r.configuration)?r.peers.filter(i=>!r.clientAssignedPeers[r.configuration].map(a=>a.id).includes(i.id)&&(!r.availablePeerSearchString||r.availablePeerSearchString&&(i.id.includes(r.availablePeerSearchString)||i.name.includes(r.availablePeerSearchString)))):r.availablePeerSearchString?r.peers.filter(i=>i.id.includes(r.availablePeerSearchString)||i.name.includes(r.availablePeerSearchString)):r.peers),y=f(!1),p=f(!1);return(i,a)=>{const c=K("RouterLink");return t(),o("div",ie,[e("div",{onClick:a[0]||(a[0]=l=>p.value=!p.value),role:"button",class:"card-header rounded-0 sticky-top bg-body-secondary border-0 border-bottom text-white d-flex"},[e("small",null,[e("samp",null,u(v.configuration),1)]),e("a",oe,[p.value?(t(),o("i",de)):(t(),o("i",re))])]),p.value?w("",!0):(t(),o("div",ce,[e("div",ue,[(t(!0),o(A,null,L(h.value,l=>(t(),o("div",{class:"list-group-item d-flex border-bottom list-group-item-action d-flex align-items-center gap-3",key:l.id},[y.value?(t(),o("div",ge,[e("small",_e,[s(n,{t:"Are you sure to remove this peer?"})]),a[2]||(a[2]=e("br",null,null,-1)),e("small",fe,[e("samp",null,u(l.id),1)])])):(t(),o("div",me,[e("small",ve,[s(c,{class:"text-decoration-none",target:"_blank",to:"/configuration/"+v.configuration+"/peers?id="+encodeURIComponent(l.id)},{default:q(()=>[e("samp",null,u(l.id),1)]),_:2},1032,["to"])]),a[1]||(a[1]=e("br",null,null,-1)),e("small",be,u(l.name?l.name:"Untitled Peer"),1)])),v.clientAssignedPeers?(t(),o("button",{key:2,onClick:b=>g("assign",l.id),class:E([{disabled:M(m).assigning},"btn bg-success-subtle text-success-emphasis ms-auto"])},[...a[3]||(a[3]=[e("i",{class:"bi bi-plus-circle-fill"},null,-1)])],10,he)):(t(),o("button",{key:3,onClick:b=>g("unassign",l.assignment_id),class:E([{disabled:M(m).unassigning},"btn bg-danger-subtle text-danger-emphasis ms-auto"]),"aria-label":"Delete Assignment"},[...a[4]||(a[4]=[e("i",{class:"bi bi-trash-fill"},null,-1)])],10,pe))]))),128))])]))])}}}),xe={key:0,class:"d-flex rounded-0 border-0 flex-column d-flex flex-column border-bottom pb-1"},ye={class:"d-flex flex-column p-3 gap-3"},ke={class:"d-flex align-items-center"},we={class:"mb-0"},Ce={class:"text-bg-primary badge ms-2"},Se={class:"text-bg-info badge ms-2"},Pe={class:"rounded-3 availablePeers border h-100 overflow-scroll flex-grow-1 d-flex flex-column"},$e={key:0,class:"text-muted m-auto p-3"},Ae={key:0,style:{height:"500px"},class:"d-flex flex-column p-3"},De={class:"availablePeers border h-100 card rounded-3"},Ie={class:"card-header sticky-top p-3"},Ne={class:"mb-0 d-flex align-items-center"},Me={class:"card-body p-0 overflow-scroll"},Be={key:0,class:"text-muted m-auto"},Re={class:"card-footer d-flex gap-2 p-3 align-items-center justify-content-end"},Ue={key:1},je=R({__name:"clientAssignedPeers",props:["client","clientAssignedPeers"],emits:["refresh"],setup(v,{emit:S}){const r=v,g=f(!1),m=V(),h=f(!1),y=S,p=async(c,l,b)=>{await m.assignClient(c,l,b,!1),y("refresh")},i=async c=>{await m.unassignClient(void 0,void 0,c),y("refresh")},a=f("");return(c,l)=>(t(),o("div",null,[g.value?(t(),o("div",Ue,[...l[6]||(l[6]=[e("div",{class:"p-3 placeholder-glow border-bottom"},[e("h6",{class:"placeholder w-100 rounded-3"}),e("div",{class:"placeholder w-100 rounded-3",style:{height:"400px"}})],-1)])])):(t(),o("div",xe,[e("div",ye,[e("div",ke,[e("h6",we,[s(n,{t:"Assigned Peers"}),e("span",Ce,[x(u(Object.keys(v.clientAssignedPeers).length)+" ",1),s(n,{t:Object.keys(v.clientAssignedPeers).length>1?"Configurations":"Configuration"},null,8,["t"])]),e("span",Se,[x(u(Object.values(v.clientAssignedPeers).flat().length)+" ",1),s(n,{t:Object.values(v.clientAssignedPeers).flat().length>1?"Peers":"Peer"},null,8,["t"])])]),e("button",{class:"btn btn-sm bg-primary-subtle text-primary-emphasis rounded-3 ms-auto",onClick:l[0]||(l[0]=b=>h.value=!h.value)},[h.value?(t(),o(A,{key:1},[l[4]||(l[4]=e("i",{class:"bi bi-check me-2"},null,-1)),s(n,{t:"Done"})],64)):(t(),o(A,{key:0},[l[3]||(l[3]=e("i",{class:"bi bi-list-check me-2"},null,-1)),s(n,{t:"Manage"})],64))])]),e("div",Pe,[(t(!0),o(A,null,L(v.clientAssignedPeers,(b,k)=>(t(),B(G,{configuration:k,peers:b,onUnassign:l[1]||(l[1]=async P=>await i(P))},null,8,["configuration","peers"]))),256)),Object.keys(v.clientAssignedPeers).length===0?(t(),o("h6",$e,[s(n,{t:"No peer assigned to this client"})])):w("",!0)])]),h.value?(t(),o("div",Ae,[e("div",De,[e("div",Ie,[e("h6",Ne,[s(n,{t:"Available Peers"})])]),e("div",Me,[(t(!0),o(A,null,L(M(m).allConfigurationsPeers,(b,k)=>(t(),B(G,{availablePeerSearchString:a.value,configuration:k,clientAssignedPeers:v.clientAssignedPeers,peers:b,key:k,onAssign:async P=>await p(k,P,r.client.ClientID)},null,8,["availablePeerSearchString","configuration","clientAssignedPeers","peers","onAssign"]))),128)),Object.keys(M(m).allConfigurationsPeers).length===0?(t(),o("h6",Be,[s(n,{t:"No peer is available to assign"})])):w("",!0)]),e("div",Re,[l[5]||(l[5]=e("label",{for:"availablePeerSearchString"},[e("i",{class:"bi bi-search me-2"})],-1)),W(e("input",{id:"availablePeerSearchString","onUpdate:modelValue":l[2]||(l[2]=b=>a.value=b),class:"form-control form-control-sm rounded-3 w-auto",type:"text"},null,512),[[Y,a.value]])])])])):w("",!0)]))]))}}),Fe={class:"p-3 d-flex gap-3 flex-column border-bottom"},Le={class:"d-flex align-items-center gap-2"},Ve={class:"mb-0"},Oe=R({__name:"clientDelete",props:["client"],emits:["refresh"],setup(v,{emit:S}){const r=v,g=f(!1),m=f(!1),h=S,y=H(),p=async()=>{g.value=!0,await J("/api/clients/deleteClient",{ClientID:r.client.ClientID},i=>{g.value=!1,i.status?(h("deleteSuccess"),y.newMessage("Server","Delete client successfully","success")):y.newMessage("Server","Failed to delete client","danger")})};return(i,a)=>(t(),o("div",Fe,[e("div",Le,[e("h6",Ve,[m.value?(t(),B(n,{key:1,t:"Are you sure to delete this client?"})):(t(),B(n,{key:0,t:"Delete Client"}))]),m.value?w("",!0):(t(),o("button",{key:0,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto",onClick:a[0]||(a[0]=c=>m.value=!0)},[a[2]||(a[2]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),s(n,{t:"Delete"})])),m.value?(t(),o(A,{key:1},[e("button",{onClick:p,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto"},[a[3]||(a[3]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),s(n,{t:"Yes"})]),m.value?(t(),o("button",{key:0,class:"btn btn-sm bg-secondary-subtle text-secondary-emphasis rounded-3",onClick:a[1]||(a[1]=c=>m.value=!1)},[a[4]||(a[4]=e("i",{class:"bi bi-x-lg me-2"},null,-1)),s(n,{t:"No"})])):w("",!0)],64)):w("",!0)])]))}}),Te={class:"p-4 border-bottom bg-body-tertiary z-0"},Ee={class:"mb-3 backLink"},Ge={class:"text-muted"},ze={class:"d-flex flex-column gap-2"},qe={class:"d-flex align-items-center"},Ke={class:"text-muted"},We={class:"ms-auto"},Ye={class:"d-flex align-items-center gap-2"},He={class:"text-muted"},Je={key:0,class:"p-3 border-bottom"},Qe={class:"d-flex justify-content-end align-items-center gap-2 mb-2"},Xe={class:"text-muted"},Ze=["selected"],es=["selected"],ss={class:"row g-3"},ts={class:"col-lg-3"},ls={class:"card rounded-3 h-100"},as={class:"card-body"},ns={class:"text-muted"},is={class:"h4 mb-1"},os={class:"small text-muted"},ds={class:"col-lg-3"},rs={class:"card rounded-3 h-100"},cs={class:"card-body"},us={class:"text-muted"},ms={class:"ms-1"},vs={class:"h4 mb-1"},bs={class:"small text-muted"},gs={class:"col-lg-3"},_s={class:"card rounded-3 h-100"},fs={class:"card-body"},hs={class:"text-muted"},ps={class:"h4 mb-1"},xs={class:"small text-muted"},ys={class:"col-lg-3"},ks={class:"card rounded-3 h-100"},ws={class:"card-body"},Cs={class:"text-muted"},Ss={class:"h5 mb-1"},Ps={class:"h6 text-muted mb-0"},$s={class:"small text-muted mt-1"},As={key:0,class:"alert alert-warning mt-3 mb-0 py-2"},Ds={style:{flex:"1 0 0","overflow-y":"scroll"}},Is={key:1,class:"d-flex w-100 h-100 text-muted"},Ns={class:"m-auto text-center"},Ms=R({__name:"clientViewer",emits:["deleteSuccess"],async setup(v,{emit:S}){let r,g;const m=V(),h=H(),y=ee(),p=le(),i=z(()=>m.getClientById(y.params.id)),a=f({}),c=f(null),l=f({sent_bps:0,recv_bps:0,updated_at:null}),b=f(window.localStorage.getItem("wgdashboard_rate_unit")||"Mbps"),k=async()=>{await F("/api/clients/assignedPeers",{ClientID:i.value.ClientID},_=>{a.value=_.data})},P=async()=>{await F("/api/clients/usageSummary",{ClientID:i.value.ClientID},_=>{c.value=_.data})},U=async()=>{await F("/api/clients/realtimeUsage",{ClientID:i.value.ClientID},_=>{l.value=_.data||{sent_bps:0,recv_bps:0,updated_at:null}})},C=se({Name:void 0}),$=_=>{const d=Number(_);if(!Number.isFinite(d))return"0 MB";const I=Math.abs(d);return I>=1024?`${(d/1024).toFixed(2)} TB`:I>=1?`${d.toFixed(2)} GB`:`${(d*1024).toFixed(2)} MB`},O=_=>{const d=Number(_||0);return b.value==="MB/s"?`${(d/1e6).toFixed(2)} MB/s`:`${(d*8/1e6).toFixed(2)} Mbps`},Q=_=>{b.value=_.target.value,window.localStorage.setItem("wgdashboard_rate_unit",b.value)};i.value?(te(()=>i.value.ClientID,async()=>{C.Name=i.value.Name,await k(),await P(),await U()}),[r,g]=j(()=>k()),await r,g(),[r,g]=j(()=>P()),await r,g(),[r,g]=j(()=>U()),await r,g(),C.Name=i.value.Name):(p.push("/clients"),h.newMessage("WGDashboard","Client does not exist","danger"));const T=f(!1),X=async()=>{T.value=!0,await J("/api/clients/updateProfileName",{ClientID:i.value.ClientID,Name:C.Name},_=>{_.status?(i.value.Name=C.Name,h.newMessage("Server","Client name update success","success")):(C.Name=i.value.Name,h.newMessage("Server","Client name update failed","danger")),T.value=!1})},Z=async()=>{await p.push("/clients"),await m.getClients()},D=f(void 0);return clearInterval(D.value),D.value=setInterval(async()=>{await U()},5e3),ae(()=>{clearInterval(D.value),D.value=void 0}),(_,d)=>{const I=K("RouterLink");return i.value?(t(),o("div",{class:"text-body d-flex flex-column overflow-y-scroll h-100",key:i.value.ClientID},[e("div",Te,[e("div",Ee,[s(I,{to:"/clients",class:"text-body text-decoration-none"},{default:q(()=>[...d[4]||(d[4]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),x(" Back",-1)])]),_:1})]),e("small",Ge,[s(n,{t:"Email"})]),e("h1",null,u(i.value.Email),1),e("div",ze,[e("div",qe,[e("small",Ke,[s(n,{t:"Client ID"})]),e("small",We,[e("samp",null,u(i.value.ClientID),1)])]),e("div",Ye,[e("small",He,[s(n,{t:"Client Name"})]),W(e("input",{class:"form-control form-control-sm rounded-3 ms-auto",style:{width:"300px"},type:"text","onUpdate:modelValue":d[0]||(d[0]=N=>C.Name=N)},null,512),[[Y,C.Name]]),e("button",{onClick:d[1]||(d[1]=N=>X()),"aria-label":"Save Client Name",class:"btn btn-sm rounded-3 bg-success-subtle border-success-subtle text-success-emphasis"},[...d[5]||(d[5]=[e("i",{class:"bi bi-save-fill"},null,-1)])])])])]),c.value?(t(),o("div",Je,[e("div",Qe,[e("small",Xe,[s(n,{t:"Realtime Units"})]),e("select",{class:"form-select form-select-sm w-auto",onChange:Q},[e("option",{value:"Mbps",selected:b.value==="Mbps"},"Mbps",8,Ze),e("option",{value:"MB/s",selected:b.value==="MB/s"},"MB/s",8,es)],32)]),e("div",ss,[e("div",ts,[e("div",ls,[e("div",as,[e("small",ns,[s(n,{t:"Total Usage"})]),e("div",is,u($(c.value.total.total_gb)),1),e("div",os,[s(n,{t:"Sent"}),x(": "+u($(c.value.total.sent_gb))+" ",1),d[6]||(d[6]=e("span",{class:"mx-2"},"•",-1)),s(n,{t:"Received"}),x(": "+u($(c.value.total.receive_gb)),1)])])])]),e("div",ds,[e("div",rs,[e("div",cs,[e("small",us,[s(n,{t:"Today"}),e("span",ms,"("+u(c.value.daily.date)+")",1)]),e("div",vs,u($(c.value.daily.total_gb)),1),e("div",bs,[s(n,{t:"Sent"}),x(": "+u($(c.value.daily.sent_gb))+" ",1),d[7]||(d[7]=e("span",{class:"mx-2"},"•",-1)),s(n,{t:"Received"}),x(": "+u($(c.value.daily.receive_gb)),1)])])])]),e("div",gs,[e("div",_s,[e("div",fs,[e("small",hs,[s(n,{t:"Assigned Peers"})]),e("div",ps,u(c.value.peers_count),1),e("div",xs,[s(n,{t:"Updated"}),x(": "+u(c.value.generated_at),1)])])])]),e("div",ys,[e("div",ks,[e("div",ws,[e("small",Cs,[s(n,{t:"Realtime Speed"})]),e("div",Ss,u(O(l.value.recv_bps))+" ↓ ",1),e("div",Ps,u(O(l.value.sent_bps))+" ↑ ",1),e("div",$s,[s(n,{t:"Updated"}),x(": "+u(l.value.updated_at||"—"),1)])])])])]),c.value.tracking_disabled_configurations&&c.value.tracking_disabled_configurations.length?(t(),o("div",As,[e("small",null,[s(n,{t:"Traffic tracking disabled for"}),x(": "+u(c.value.tracking_disabled_configurations.join(", ")),1)])])):w("",!0)])):w("",!0),e("div",Ds,[s(je,{onRefresh:d[2]||(d[2]=N=>k()),clientAssignedPeers:a.value,client:i.value},null,8,["clientAssignedPeers","client"]),s(Oe,{onDeleteSuccess:d[3]||(d[3]=N=>Z()),client:i.value},null,8,["client"])])])):(t(),o("div",Is,[e("div",Ns,[d[8]||(d[8]=e("h1",null,[e("i",{class:"bi bi-person-x"})],-1)),e("p",null,[s(n,{t:"Client does not exist"})])])]))}}}),Fs=ne(Ms,[["__scopeId","data-v-8806cc7d"]]);export{Fs as default};

import{_ as v,G as f,C as I,c as a,a as t,t as C,n as T,q as m,A as h,b as l,j as g,d as x,F as k,k as w,f as i,D as L,l as $,a1 as E,v as M,e as D,w as A,T as U,B,r as R,g as y,x as q,h as O,o as P,i as j}from"./index-B55XVIyK.js";import{M as H}from"./message-BwDYnJk-.js";import{d as _}from"./dayjs.min-C30UiOfM.js";import{L as S}from"./localeText-u9q1EmJq.js";const G={name:"RemoteServer",components:{LocaleText:S},props:{server:Object},data(){return{active:!1,startTime:void 0,endTime:void 0,errorMsg:"",refreshing:!1}},methods:{addHeaders(){this.server.headers||(this.server.headers={}),this.server.headers[I().toString()]={key:"",value:""}},async handshake(){this.active=!1,this.server.host&&this.server.apiKey&&(this.refreshing=!0,this.startTime=void 0,this.endTime=void 0,this.startTime=_(),await fetch(`${this.server.host}/api/handshake`,{headers:this.getHeaders,method:"GET",signal:AbortSignal.timeout(5e3)}).then(s=>{if(s.status===200)return s.json();throw new Error(s.statusText)}).then(()=>{this.endTime=_(),this.active=!0}).catch(s=>{this.active=!1,this.errorMsg=s}),this.refreshing=!1)},async connect(){await fetch(`${this.server.host}/api/authenticate`,{headers:this.getHeaders,body:JSON.stringify({host:window.location.hostname}),method:"POST",signal:AbortSignal.timeout(5e3)}).then(s=>s.json()).then(s=>{this.$emit("setActiveServer"),this.$router.push("/")})}},mounted(){this.handshake()},computed:{getHandshakeTime(){return this.startTime&&this.endTime?`${_().subtract(this.startTime).millisecond()}ms`:this.refreshing?f("Pinging..."):this.errorMsg?this.errorMsg:"N/A"},getHeaders(){let s={"Content-Type":"application/json","wg-dashboard-apikey":this.server.apiKey};if(this.server.headers)for(let e of Object.values(this.server.headers))e.key&&e.value&&!Object.keys(s).includes(e.key)&&(s[e.key]=e.value);return s}}},N={class:"card rounded-3"},K={class:"gap-2 d-flex align-items-center"},W={key:0,class:"spin ms-auto text-white"},z={class:"card-body"},F={class:"d-flex gap-2 w-100 remoteServerContainer flex-column"},J={class:"d-flex gap-3 align-items-center flex-grow-1"},Z={class:"d-flex gap-3 align-items-center flex-grow-1"},Q={class:"d-flex gap-2 button-group"},X={class:"card rounded-3"},Y={class:"card-body d-flex gap-2 flex-column"},ee={class:"d-flex gap-2"},te={class:"flex-grow-1"},se=["onUpdate:modelValue"],oe={class:"flex-grow-1"},re=["onUpdate:modelValue"],ie=["onClick"];function ne(s,e,c,p,u,d){const r=g("LocaleText");return i(),a("div",N,[t("div",{class:T(["card-header",[this.active?"text-bg-success":"text-bg-danger"]])},[t("div",K,[e[12]||(e[12]=t("i",{class:"bi bi-person-walking"},null,-1)),t("small",null,C(this.getHandshakeTime),1),this.refreshing?(i(),a("div",W,[...e[10]||(e[10]=[t("i",{class:"bi bi-arrow-clockwise"},null,-1)])])):(i(),a("a",{key:1,role:"button",onClick:e[0]||(e[0]=n=>this.handshake()),class:"text-white text-decoration-none ms-auto disabled"},[...e[11]||(e[11]=[t("i",{class:"bi bi-arrow-clockwise me"},null,-1)])]))])],2),t("div",z,[t("div",F,[t("div",J,[e[13]||(e[13]=t("small",null,[t("i",{class:"bi bi-hdd-rack-fill"})],-1)),m(t("input",{class:"form-control form-control-sm rounded-3",onBlur:e[1]||(e[1]=n=>this.handshake()),"onUpdate:modelValue":e[2]||(e[2]=n=>this.server.host=n),type:"url"},null,544),[[h,this.server.host]])]),t("div",Z,[e[14]||(e[14]=t("i",{class:"bi bi-key-fill"},null,-1)),m(t("input",{class:"form-control form-control-sm rounded-3 font-monospace",onBlur:e[3]||(e[3]=n=>this.handshake()),"onUpdate:modelValue":e[4]||(e[4]=n=>this.server.apiKey=n),type:"text"},null,544),[[h,this.server.apiKey]])]),t("div",Q,[t("button",{style:{flex:"1 0 0"},onClick:e[5]||(e[5]=n=>this.$emit("delete")),class:"ms-auto btn btn-sm bg-danger-subtle text-danger-emphasis border-1 border-danger-subtle rounded-3"},[e[15]||(e[15]=t("i",{class:"bi bi-trash me-2"},null,-1)),l(r,{t:"Delete"})]),t("button",{style:{flex:"1 0 0"},onClick:e[6]||(e[6]=n=>this.connect()),class:T([{disabled:!this.active},"ms-auto btn btn-sm bg-success-subtle text-success-emphasis border-1 border-success-subtle rounded-3"])},[e[16]||(e[16]=t("i",{class:"bi bi-arrow-right-circle me-2"},null,-1)),l(r,{t:"Connect"})],2)]),t("div",X,[t("div",Y,[t("button",{style:{flex:"1 0 0"},onClick:e[7]||(e[7]=n=>d.addHeaders()),class:"btn btn-sm bg-primary-subtle text-primary-emphasis border-1 border-primary-subtle rounded-3"},[e[17]||(e[17]=t("i",{class:"bi bi-plus-lg me-2"},null,-1)),l(r,{t:"Headers"})]),this.server.headers?(i(!0),a(k,{key:0},w(this.server.headers,(n,b)=>(i(),a("div",ee,[t("div",te,[m(t("input",{class:"form-control rounded-3 form-control-sm",onBlur:e[8]||(e[8]=o=>this.handshake()),"onUpdate:modelValue":o=>n.key=o,placeholder:"Key"},null,40,se),[[h,n.key]])]),t("div",oe,[m(t("input",{class:"form-control rounded-3 form-control-sm",onBlur:e[9]||(e[9]=o=>this.handshake()),"onUpdate:modelValue":o=>n.value=o,placeholder:"Value"},null,40,re),[[h,n.value]])]),t("button",{type:"button",onClick:o=>delete this.server.headers[b],class:"btn btn-sm bg-danger-subtle text-danger-emphasis border-danger-subtle rounded-3"},[...e[18]||(e[18]=[t("i",{class:"bi bi-trash-fill"},null,-1)])],8,ie)]))),256)):x("",!0)])])])])])}const ae=v(G,[["render",ne],["__scopeId","data-v-87b9c3d8"]]),le={name:"RemoteServerList",setup(){return{store:L()}},components:{LocaleText:S,RemoteServer:ae}},de={class:"w-100 mt-3"},ue={class:"d-flex align-items-center mb-3"},me={class:"mb-0"},ce={class:"w-100 d-flex gap-3 flex-column p-3 border border-1 border-secondary-subtle rounded-3",style:{height:"400px","overflow-y":"scroll"}},he={key:0,class:"text-muted m-auto"};function pe(s,e,c,p,u,d){const r=g("LocaleText"),n=g("RemoteServer");return i(),a("div",de,[t("div",ue,[t("h5",me,[l(r,{t:"Server List"})]),t("button",{onClick:e[0]||(e[0]=b=>this.store.addCrossServerConfiguration()),class:"btn bg-primary-subtle text-primary-emphasis border-1 border-primary-subtle shadow-sm ms-auto"},[e[1]||(e[1]=t("i",{class:"bi bi-plus-circle-fill me-2"},null,-1)),l(r,{t:"Server"})])]),t("div",ce,[(i(!0),a(k,null,w(this.store.CrossServerConfiguration.ServerList,(b,o)=>(i(),$(n,{onSetActiveServer:V=>this.store.setActiveCrossServer(o),onDelete:V=>this.store.deleteCrossServerConfiguration(o),key:o,server:b},null,8,["onSetActiveServer","onDelete","server"]))),128)),Object.keys(this.store.CrossServerConfiguration.ServerList).length===0?(i(),a("h6",he,[l(r,{t:"Click"}),e[2]||(e[2]=t("i",{class:"bi bi-plus-circle-fill mx-1"},null,-1)),l(r,{t:"to add your server"})])):x("",!0)])])}const fe=v(le,[["render",pe]]),be={name:"signInInput",methods:{GetLocale:f},props:{id:"",data:"",type:"",placeholder:""},computed:{getLocaleText(){return f(this.placeholder)}}},ge=["type","id","name","placeholder"];function ve(s,e,c,p,u,d){return m((i(),a("input",{type:c.type,"onUpdate:modelValue":e[0]||(e[0]=r=>this.data[this.id]=r),class:"form-control rounded-3",id:this.id,name:this.id,autocomplete:"on",placeholder:this.getLocaleText,required:""},null,8,ge)),[[E,this.data[this.id]]])}const xe=v(be,[["render",ve]]),ye={name:"signInTOTP",methods:{GetLocale:f},props:{data:""},computed:{getLocaleText(){return f("OTP from your authenticator")}}},_e=["placeholder"];function $e(s,e,c,p,u,d){return m((i(),a("input",{class:"form-control totp",required:"",id:"totp",maxlength:"6",type:"text",inputmode:"numeric",autocomplete:"one-time-code",placeholder:this.getLocaleText,"onUpdate:modelValue":e[0]||(e[0]=r=>this.data.totp=r)},null,8,_e)),[[h,this.data.totp]])}const ke=v(ye,[["render",$e]]),we={name:"signin",components:{SignInTOTP:ke,SignInInput:xe,LocaleText:S,RemoteServerList:fe,Message:H},async setup(){const s=L(),e=R("dark");let c=!1,p;s.IsElectronApp||await Promise.all([y("/api/getDashboardTheme",{},d=>{e.value=d.data}),y("/api/isTotpEnabled",{},d=>{c=d.data}),y("/api/getDashboardVersion",{},d=>{p=d.data})]),s.removeActiveCrossServer();const u=q(()=>O(e.value));return P(()=>{j()}),{store:s,theme:e,resolvedTheme:u,totpEnabled:c,version:p}},data(){return{data:{username:"",password:"",totp:""},loginError:!1,loginErrorMessage:"",loading:!1}},computed:{getMessages(){return this.store.Messages.filter(s=>s.show)},applyLocale(s){return f(s)},formValid(){return this.data.username&&this.data.password&&(this.totpEnabled&&this.data.totp||!this.totpEnabled)}},methods:{GetLocale:f,async auth(){this.formValid?(this.loading=!0,await B("/api/authenticate",this.data,s=>{s.status?(this.loginError=!1,this.$refs.signInBtn.classList.add("signedIn"),s.message?this.$router.push("/welcome"):this.store.Redirect!==void 0?this.$router.push(this.store.Redirect):this.$router.push("/")):(this.store.newMessage("Server",s.message,"danger"),document.querySelectorAll("input[required]").forEach(e=>{e.classList.remove("is-valid"),e.classList.add("is-invalid")}),this.loading=!1)})):document.querySelectorAll("input[required]").forEach(s=>{s.value.length===0?(s.classList.remove("is-valid"),s.classList.add("is-invalid")):(s.classList.remove("is-invalid"),s.classList.add("is-valid"))})}}},Se=["data-bs-theme"],Te={class:"login-box m-auto"},Ce={class:"m-auto signInContainer",style:{width:"700px"}},Le={class:"mb-0 text-body"},Ve={class:"form-floating mb-2"},Ie=["disabled"],Ee={for:"floatingInput",class:"d-flex"},Me={class:"form-floating mb-2"},De=["disabled"],Ae={for:"floatingInput",class:"d-flex"},Ue={key:0,class:"form-floating mb-2"},Be=["disabled"],Re={for:"floatingInput",class:"d-flex"},qe=["disabled"],Oe={key:0,class:"d-flex w-100"},Pe={key:1,class:"d-flex w-100 align-items-center"},je={key:2,class:"d-flex mt-3"},He={class:"form-check form-switch ms-auto"},Ge=["disabled"],Ne={class:"form-check-label",for:"flexSwitchCheckChecked"},Ke={class:"text-muted pb-3 d-block w-100 text-center mt-3"},We={class:"messageCentre text-body position-absolute d-flex"};function ze(s,e,c,p,u,d){const r=g("LocaleText"),n=g("RemoteServerList"),b=g("Message");return i(),a("div",{class:"container-fluid login-container-fluid d-flex main flex-column py-4 text-body h-100",style:{"overflow-y":"scroll"},"data-bs-theme":this.resolvedTheme},[t("div",Te,[t("div",Ce,[t("h4",Le,[l(r,{t:"Welcome to"})]),e[10]||(e[10]=t("span",{class:"dashboardLogo display-3"},[t("strong",null,"WGDashboard")],-1)),this.store.CrossServerConfiguration.Enable?(i(),$(n,{key:1})):(i(),a("form",{key:0,onSubmit:e[3]||(e[3]=o=>{o.preventDefault(),this.auth()}),class:"mt-3"},[t("div",Ve,[m(t("input",{type:"text",required:"",disabled:u.loading,"onUpdate:modelValue":e[0]||(e[0]=o=>this.data.username=o),name:"username",autocomplete:"username",autofocus:"",class:"form-control rounded-3",id:"username",placeholder:"Username"},null,8,Ie),[[h,this.data.username]]),t("label",Ee,[e[5]||(e[5]=t("i",{class:"bi bi-person-circle me-2"},null,-1)),l(r,{t:"Username"})])]),t("div",Me,[m(t("input",{type:"password",required:"",disabled:u.loading,autocomplete:"current-password","onUpdate:modelValue":e[1]||(e[1]=o=>this.data.password=o),class:"form-control rounded-3",id:"password",placeholder:"Password"},null,8,De),[[h,this.data.password]]),t("label",Ae,[e[6]||(e[6]=t("i",{class:"bi bi-key-fill me-2"},null,-1)),l(r,{t:"Password"})])]),this.totpEnabled?(i(),a("div",Ue,[m(t("input",{type:"text",id:"totp",required:"",disabled:u.loading,placeholder:"totp","onUpdate:modelValue":e[2]||(e[2]=o=>this.data.totp=o),class:"form-control rounded-3",maxlength:"6",inputmode:"numeric",autocomplete:"one-time-code"},null,8,Be),[[h,this.data.totp]]),t("label",Re,[e[7]||(e[7]=t("i",{class:"bi bi-lock-fill me-2"},null,-1)),l(r,{t:"OTP from your authenticator"})])])):x("",!0),t("button",{class:"btn btn-lg btn-dark ms-auto mt-5 w-100 d-flex btn-brand signInBtn rounded-3",disabled:this.loading||!this.formValid,ref:"signInBtn"},[this.loading?(i(),a("span",Pe,[l(r,{t:"Signing In..."}),e[9]||(e[9]=t("span",{class:"spinner-border ms-auto spinner-border-sm",role:"status"},null,-1))])):(i(),a("span",Oe,[l(r,{t:"Sign In"}),e[8]||(e[8]=t("i",{class:"ms-auto bi bi-chevron-right"},null,-1))]))],8,qe)],32)),this.store.IsElectronApp?x("",!0):(i(),a("div",je,[t("div",He,[m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>this.store.CrossServerConfiguration.Enable=o),disabled:u.loading,class:"form-check-input",type:"checkbox",role:"switch",id:"flexSwitchCheckChecked"},null,8,Ge),[[M,this.store.CrossServerConfiguration.Enable]]),t("label",Ne,[l(r,{t:"Access Remote Server"})])])]))])]),t("small",Ke,[D(" WGDashboard "+C(this.version)+" | Developed with ❤️ by ",1),e[11]||(e[11]=t("a",{href:"https://github.com/donaldzou",target:"_blank"},[t("strong",null,"Donald Zou")],-1))]),t("div",We,[l(U,{name:"message",tag:"div",class:"position-relative flex-sm-grow-0 flex-grow-1 d-flex align-items-end ms-sm-auto flex-column gap-2"},{default:A(()=>[(i(!0),a(k,null,w(d.getMessages.slice().reverse(),o=>(i(),$(b,{message:o,key:o.id},null,8,["message"]))),128))]),_:1})])],8,Se)}const Xe=v(we,[["render",ze],["__scopeId","data-v-4d9eaf8d"]]);export{Xe as default};

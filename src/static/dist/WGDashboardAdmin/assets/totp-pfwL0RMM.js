import{_ as u,c as p,a as t,b as i,j as d,t as f,q as _,A as b,l as r,w as c,B as v,h as g,i as x,D as y,g as T,f as n}from"./index-BeJQzLUm.js";import{Q as k}from"./browser-Lrk2PQI9.js";import{L}from"./localeText-B0FHIejQ.js";import"./galois-field-I2lBzzs-.js";const w={name:"totp",components:{LocaleText:L},async setup(){const s=y();let e="";return await T("/api/Welcome_GetTotpLink",{},(a=>{a.status&&(e=a.data)})),{l:e,store:s}},mounted(){x(),this.l&&k.toCanvas(document.getElementById("qrcode"),this.l,function(s){})},computed:{resolvedTheme(){return g(this.store.Configuration.Server.dashboard_theme)}},data(){return{totp:"",totpInvalidMessage:"",verified:!1}},methods:{validateTotp(){}},watch:{totp(s){const e=document.querySelector("#totp");e.classList.remove("is-invalid","is-valid"),s.length===6&&(console.log(s),/[0-9]{6}/.test(s)?v("/api/Welcome_VerifyTotpLink",{totp:s},a=>{a.status?(this.verified=!0,e.classList.add("is-valid"),this.$emit("verified")):(e.classList.add("is-invalid"),this.totpInvalidMessage="TOTP does not match.")}):(e.classList.add("is-invalid"),this.totpInvalidMessage="TOTP can only contain numbers"))}}},C=["data-bs-theme"],M={class:"m-auto text-body",style:{width:"500px"}},P={class:"d-flex flex-column"},B={class:"dashboardLogo display-4"},I={class:"mb-2"},O={class:"text-muted"},S={class:"p-3 bg-body-secondary rounded-3 border mb-3"},q={class:"text-muted mb-0"},A=["href"],D={style:{"line-break":"anywhere"}},R={for:"totp",class:"mb-2"},$={class:"text-muted"},E={class:"form-group mb-2"},F=["disabled"],Q={class:"invalid-feedback"},W={class:"valid-feedback"},G={class:"d-flex gap-3 mt-5 flex-column"};function N(s,e,a,j,U,h){const o=d("LocaleText"),l=d("RouterLink");return n(),p("div",{class:"container-fluid login-container-fluid d-flex main pt-5 overflow-scroll","data-bs-theme":h.resolvedTheme},[t("div",M,[t("div",P,[t("div",null,[t("h1",B,[i(o,{t:"Multi-Factor Authentication (MFA)"})]),t("p",I,[t("small",O,[i(o,{t:"1. Please scan the following QR Code to generate TOTP with your choice of authenticator"})])]),e[1]||(e[1]=t("canvas",{id:"qrcode",class:"rounded-3 mb-2"},null,-1)),t("div",S,[t("p",q,[t("small",null,[i(o,{t:"Or you can click the link below:"})])]),t("a",{href:this.l},[t("code",D,f(this.l),1)],8,A)]),t("label",R,[t("small",$,[i(o,{t:"2. Enter the TOTP generated by your authenticator to verify"})])]),t("div",E,[_(t("input",{class:"form-control text-center totp",id:"totp",maxlength:"6",type:"text",inputmode:"numeric",autocomplete:"one-time-code","onUpdate:modelValue":e[0]||(e[0]=m=>this.totp=m),disabled:this.verified},null,8,F),[[b,this.totp]]),t("div",Q,[i(o,{t:this.totpInvalidMessage},null,8,["t"])]),t("div",W,[i(o,{t:"TOTP verified!"})])])]),e[4]||(e[4]=t("hr",null,null,-1)),t("div",G,[this.verified?(n(),r(l,{key:1,to:"/",class:"btn btn-dark btn-lg d-flex btn-brand shadow align-items-center flex-grow-1 rounded-3"},{default:c(()=>[i(o,{t:"Complete"}),e[3]||(e[3]=t("i",{class:"bi bi-chevron-right ms-auto"},null,-1))]),_:1})):(n(),r(l,{key:0,to:"/",class:"btn bg-secondary-subtle text-secondary-emphasis rounded-3 flex-grow-1 btn-lg border-1 border-secondary-subtle shadow d-flex"},{default:c(()=>[i(o,{t:"I don't need MFA"}),e[2]||(e[2]=t("i",{class:"bi bi-chevron-right ms-auto"},null,-1))]),_:1}))])])])],8,C)}const K=u(w,[["render",N]]);export{K as default};

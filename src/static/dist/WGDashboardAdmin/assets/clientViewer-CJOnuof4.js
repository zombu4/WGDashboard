import{E as B,x as H,r as h,c as r,a as e,d as w,t as u,F as D,k as L,b as t,w as K,j as W,n as G,u as M,f as l,e as y,q as Y,A as J,l as R,D as Q,B as X,N as te,L as le,K as ae,I as j,M as ne,z as ie,g as F,_ as oe}from"./index-Cf4jNNie.js";import{D as V}from"./DashboardClientAssignmentStore-C0zk0yEL.js";import{L as n}from"./localeText-BilYarrN.js";import{S as re}from"./sparkline-CpwHfFtF.js";const de={class:"card rounded-0 border-0"},ce={role:"button",class:"ms-auto text-white"},ue={key:0,class:"bi bi-chevron-compact-down"},me={key:1,class:"bi bi-chevron-compact-up"},ve={key:0,class:"card-body p-0"},be={class:"list-group list-group-flush"},ge={key:0},_e={class:"text-body"},he={class:"text-muted"},fe={key:1},pe={class:"text-body"},xe={class:"text-muted"},ye=["onClick"],ke=["onClick"],z=B({__name:"availablePeersGroup",props:["configuration","peers","clientAssignedPeers","availablePeerSearchString"],emits:["assign","unassign"],setup(b,{emit:P}){const d=b,g=P,v=V(),f=H(()=>d.clientAssignedPeers&&Object.keys(d.clientAssignedPeers).includes(d.configuration)?d.peers.filter(i=>!d.clientAssignedPeers[d.configuration].map(a=>a.id).includes(i.id)&&(!d.availablePeerSearchString||d.availablePeerSearchString&&(i.id.includes(d.availablePeerSearchString)||i.name.includes(d.availablePeerSearchString)))):d.availablePeerSearchString?d.peers.filter(i=>i.id.includes(d.availablePeerSearchString)||i.name.includes(d.availablePeerSearchString)):d.peers),k=h(!1),p=h(!1);return(i,a)=>{const c=W("RouterLink");return l(),r("div",de,[e("div",{onClick:a[0]||(a[0]=s=>p.value=!p.value),role:"button",class:"card-header rounded-0 sticky-top bg-body-secondary border-0 border-bottom text-white d-flex"},[e("small",null,[e("samp",null,u(b.configuration),1)]),e("a",ce,[p.value?(l(),r("i",ue)):(l(),r("i",me))])]),p.value?w("",!0):(l(),r("div",ve,[e("div",be,[(l(!0),r(D,null,L(f.value,s=>(l(),r("div",{class:"list-group-item d-flex border-bottom list-group-item-action d-flex align-items-center gap-3",key:s.id},[k.value?(l(),r("div",fe,[e("small",pe,[t(n,{t:"Are you sure to remove this peer?"})]),a[2]||(a[2]=e("br",null,null,-1)),e("small",xe,[e("samp",null,u(s.id),1)])])):(l(),r("div",ge,[e("small",_e,[t(c,{class:"text-decoration-none",target:"_blank",to:"/configuration/"+b.configuration+"/peers?id="+encodeURIComponent(s.id)},{default:K(()=>[e("samp",null,u(s.id),1)]),_:2},1032,["to"])]),a[1]||(a[1]=e("br",null,null,-1)),e("small",he,u(s.name?s.name:"Untitled Peer"),1)])),b.clientAssignedPeers?(l(),r("button",{key:2,onClick:m=>g("assign",s.id),class:G([{disabled:M(v).assigning},"btn bg-success-subtle text-success-emphasis ms-auto"])},[...a[3]||(a[3]=[e("i",{class:"bi bi-plus-circle-fill"},null,-1)])],10,ye)):(l(),r("button",{key:3,onClick:m=>g("unassign",s.assignment_id),class:G([{disabled:M(v).unassigning},"btn bg-danger-subtle text-danger-emphasis ms-auto"]),"aria-label":"Delete Assignment"},[...a[4]||(a[4]=[e("i",{class:"bi bi-trash-fill"},null,-1)])],10,ke))]))),128))])]))])}}}),we={key:0,class:"d-flex rounded-0 border-0 flex-column d-flex flex-column border-bottom pb-1"},Ce={class:"d-flex flex-column p-3 gap-3"},Se={class:"d-flex align-items-center"},Pe={class:"mb-0"},$e={class:"text-bg-primary badge ms-2"},Ae={class:"text-bg-info badge ms-2"},De={class:"rounded-3 availablePeers border h-100 overflow-scroll flex-grow-1 d-flex flex-column"},Ne={key:0,class:"text-muted m-auto p-3"},Ie={key:0,style:{height:"500px"},class:"d-flex flex-column p-3"},Me={class:"availablePeers border h-100 card rounded-3"},Re={class:"card-header sticky-top p-3"},Be={class:"mb-0 d-flex align-items-center"},Ue={class:"card-body p-0 overflow-scroll"},je={key:0,class:"text-muted m-auto"},Fe={class:"card-footer d-flex gap-2 p-3 align-items-center justify-content-end"},Le={key:1},Ve=B({__name:"clientAssignedPeers",props:["client","clientAssignedPeers"],emits:["refresh"],setup(b,{emit:P}){const d=b,g=h(!1),v=V(),f=h(!1),k=P,p=async(c,s,m)=>{await v.assignClient(c,s,m,!1),k("refresh")},i=async c=>{await v.unassignClient(void 0,void 0,c),k("refresh")},a=h("");return(c,s)=>(l(),r("div",null,[g.value?(l(),r("div",Le,[...s[6]||(s[6]=[e("div",{class:"p-3 placeholder-glow border-bottom"},[e("h6",{class:"placeholder w-100 rounded-3"}),e("div",{class:"placeholder w-100 rounded-3",style:{height:"400px"}})],-1)])])):(l(),r("div",we,[e("div",Ce,[e("div",Se,[e("h6",Pe,[t(n,{t:"Assigned Peers"}),e("span",$e,[y(u(Object.keys(b.clientAssignedPeers).length)+" ",1),t(n,{t:Object.keys(b.clientAssignedPeers).length>1?"Configurations":"Configuration"},null,8,["t"])]),e("span",Ae,[y(u(Object.values(b.clientAssignedPeers).flat().length)+" ",1),t(n,{t:Object.values(b.clientAssignedPeers).flat().length>1?"Peers":"Peer"},null,8,["t"])])]),e("button",{class:"btn btn-sm bg-primary-subtle text-primary-emphasis rounded-3 ms-auto",onClick:s[0]||(s[0]=m=>f.value=!f.value)},[f.value?(l(),r(D,{key:1},[s[4]||(s[4]=e("i",{class:"bi bi-check me-2"},null,-1)),t(n,{t:"Done"})],64)):(l(),r(D,{key:0},[s[3]||(s[3]=e("i",{class:"bi bi-list-check me-2"},null,-1)),t(n,{t:"Manage"})],64))])]),e("div",De,[(l(!0),r(D,null,L(b.clientAssignedPeers,(m,x)=>(l(),R(z,{configuration:x,peers:m,onUnassign:s[1]||(s[1]=async C=>await i(C))},null,8,["configuration","peers"]))),256)),Object.keys(b.clientAssignedPeers).length===0?(l(),r("h6",Ne,[t(n,{t:"No peer assigned to this client"})])):w("",!0)])]),f.value?(l(),r("div",Ie,[e("div",Me,[e("div",Re,[e("h6",Be,[t(n,{t:"Available Peers"})])]),e("div",Ue,[(l(!0),r(D,null,L(M(v).allConfigurationsPeers,(m,x)=>(l(),R(z,{availablePeerSearchString:a.value,configuration:x,clientAssignedPeers:b.clientAssignedPeers,peers:m,key:x,onAssign:async C=>await p(x,C,d.client.ClientID)},null,8,["availablePeerSearchString","configuration","clientAssignedPeers","peers","onAssign"]))),128)),Object.keys(M(v).allConfigurationsPeers).length===0?(l(),r("h6",je,[t(n,{t:"No peer is available to assign"})])):w("",!0)]),e("div",Fe,[s[5]||(s[5]=e("label",{for:"availablePeerSearchString"},[e("i",{class:"bi bi-search me-2"})],-1)),Y(e("input",{id:"availablePeerSearchString","onUpdate:modelValue":s[2]||(s[2]=m=>a.value=m),class:"form-control form-control-sm rounded-3 w-auto",type:"text"},null,512),[[J,a.value]])])])])):w("",!0)]))]))}}),Oe={class:"p-3 d-flex gap-3 flex-column border-bottom"},Te={class:"d-flex align-items-center gap-2"},Ee={class:"mb-0"},Ge=B({__name:"clientDelete",props:["client"],emits:["refresh"],setup(b,{emit:P}){const d=b,g=h(!1),v=h(!1),f=P,k=Q(),p=async()=>{g.value=!0,await X("/api/clients/deleteClient",{ClientID:d.client.ClientID},i=>{g.value=!1,i.status?(f("deleteSuccess"),k.newMessage("Server","Delete client successfully","success")):k.newMessage("Server","Failed to delete client","danger")})};return(i,a)=>(l(),r("div",Oe,[e("div",Te,[e("h6",Ee,[v.value?(l(),R(n,{key:1,t:"Are you sure to delete this client?"})):(l(),R(n,{key:0,t:"Delete Client"}))]),v.value?w("",!0):(l(),r("button",{key:0,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto",onClick:a[0]||(a[0]=c=>v.value=!0)},[a[2]||(a[2]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),t(n,{t:"Delete"})])),v.value?(l(),r(D,{key:1},[e("button",{onClick:p,class:"btn btn-sm bg-danger-subtle text-danger-emphasis rounded-3 ms-auto"},[a[3]||(a[3]=e("i",{class:"bi bi-trash-fill me-2"},null,-1)),t(n,{t:"Yes"})]),v.value?(l(),r("button",{key:0,class:"btn btn-sm bg-secondary-subtle text-secondary-emphasis rounded-3",onClick:a[1]||(a[1]=c=>v.value=!1)},[a[4]||(a[4]=e("i",{class:"bi bi-x-lg me-2"},null,-1)),t(n,{t:"No"})])):w("",!0)],64)):w("",!0)])]))}}),ze={class:"p-4 border-bottom bg-body-tertiary z-0"},qe={class:"mb-3 backLink"},He={class:"text-muted"},Ke={class:"d-flex flex-column gap-2"},We={class:"d-flex align-items-center"},Ye={class:"text-muted"},Je={class:"ms-auto"},Qe={class:"d-flex align-items-center gap-2"},Xe={class:"text-muted"},Ze={key:0,class:"p-3 border-bottom"},es={class:"d-flex justify-content-end align-items-center gap-2 mb-2"},ss={class:"text-muted"},ts=["selected"],ls=["selected"],as={class:"row g-3"},ns={class:"col-lg-3"},is={class:"card rounded-3 h-100"},os={class:"card-body"},rs={class:"text-muted"},ds={class:"h4 mb-1"},cs={class:"small text-muted"},us={class:"col-lg-3"},ms={class:"card rounded-3 h-100"},vs={class:"card-body"},bs={class:"text-muted"},gs={class:"ms-1"},_s={class:"h4 mb-1"},hs={class:"small text-muted"},fs={class:"col-lg-3"},ps={class:"card rounded-3 h-100"},xs={class:"card-body"},ys={class:"text-muted"},ks={class:"h4 mb-1"},ws={class:"small text-muted"},Cs={class:"col-lg-3"},Ss={class:"card rounded-3 h-100"},Ps={class:"card-body"},$s={class:"text-muted"},As={class:"h5 mb-1"},Ds={class:"h6 text-muted mb-0"},Ns={class:"mt-2"},Is={class:"small text-muted mt-1"},Ms={key:0,class:"alert alert-warning mt-3 mb-0 py-2"},Rs={style:{flex:"1 0 0","overflow-y":"scroll"}},Bs={key:1,class:"d-flex w-100 h-100 text-muted"},Us={class:"m-auto text-center"},q=30,js=B({__name:"clientViewer",emits:["deleteSuccess"],async setup(b,{emit:P}){let d,g;const v=V(),f=Q(),k=te(),p=ne(),i=H(()=>v.getClientById(k.params.id)),a=h({}),c=h(null),s=h({sent_bps:0,recv_bps:0,updated_at:null}),m=h({sent:[],recv:[]}),x=h(window.localStorage.getItem("wgdashboard_rate_unit")||"Mbps"),C=async()=>{await F("/api/clients/assignedPeers",{ClientID:i.value.ClientID},_=>{a.value=_.data})},O=async()=>{await F("/api/clients/usageSummary",{ClientID:i.value.ClientID},_=>{c.value=_.data})},U=async()=>{await F("/api/clients/realtimeUsage",{ClientID:i.value.ClientID},_=>{s.value=_.data||{sent_bps:0,recv_bps:0,updated_at:null};const o=Number(s.value.sent_bps||0),A=Number(s.value.recv_bps||0);m.value.sent.push(o),m.value.recv.push(A),m.value.sent.length>q&&m.value.sent.shift(),m.value.recv.length>q&&m.value.recv.shift()})},S=le({Name:void 0}),$=_=>{const o=Number(_);if(!Number.isFinite(o))return"0 MB";const A=Math.abs(o);return A>=1024?`${(o/1024).toFixed(2)} TB`:A>=1?`${o.toFixed(2)} GB`:`${(o*1024).toFixed(2)} MB`},T=_=>{const o=Number(_||0);return x.value==="MB/s"?`${(o/1e6).toFixed(2)} MB/s`:`${(o*8/1e6).toFixed(2)} Mbps`},Z=_=>{x.value=_.target.value,window.localStorage.setItem("wgdashboard_rate_unit",x.value)};i.value?(ae(()=>i.value.ClientID,async()=>{m.value={sent:[],recv:[]},S.Name=i.value.Name,await C(),await O(),await U()}),[d,g]=j(()=>C()),await d,g(),[d,g]=j(()=>O()),await d,g(),[d,g]=j(()=>U()),await d,g(),S.Name=i.value.Name):(p.push("/clients"),f.newMessage("WGDashboard","Client does not exist","danger"));const E=h(!1),ee=async()=>{E.value=!0,await X("/api/clients/updateProfileName",{ClientID:i.value.ClientID,Name:S.Name},_=>{_.status?(i.value.Name=S.Name,f.newMessage("Server","Client name update success","success")):(S.Name=i.value.Name,f.newMessage("Server","Client name update failed","danger")),E.value=!1})},se=async()=>{await p.push("/clients"),await v.getClients()},N=h(void 0);return clearInterval(N.value),N.value=setInterval(async()=>{await U()},5e3),ie(()=>{clearInterval(N.value),N.value=void 0}),(_,o)=>{const A=W("RouterLink");return i.value?(l(),r("div",{class:"text-body d-flex flex-column overflow-y-scroll h-100",key:i.value.ClientID},[e("div",ze,[e("div",qe,[t(A,{to:"/clients",class:"text-body text-decoration-none"},{default:K(()=>[...o[4]||(o[4]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),y(" Back",-1)])]),_:1})]),e("small",He,[t(n,{t:"Email"})]),e("h1",null,u(i.value.Email),1),e("div",Ke,[e("div",We,[e("small",Ye,[t(n,{t:"Client ID"})]),e("small",Je,[e("samp",null,u(i.value.ClientID),1)])]),e("div",Qe,[e("small",Xe,[t(n,{t:"Client Name"})]),Y(e("input",{class:"form-control form-control-sm rounded-3 ms-auto",style:{width:"300px"},type:"text","onUpdate:modelValue":o[0]||(o[0]=I=>S.Name=I)},null,512),[[J,S.Name]]),e("button",{onClick:o[1]||(o[1]=I=>ee()),"aria-label":"Save Client Name",class:"btn btn-sm rounded-3 bg-success-subtle border-success-subtle text-success-emphasis"},[...o[5]||(o[5]=[e("i",{class:"bi bi-save-fill"},null,-1)])])])])]),c.value?(l(),r("div",Ze,[e("div",es,[e("small",ss,[t(n,{t:"Realtime Units"})]),e("select",{class:"form-select form-select-sm w-auto",onChange:Z},[e("option",{value:"Mbps",selected:x.value==="Mbps"},"Mbps",8,ts),e("option",{value:"MB/s",selected:x.value==="MB/s"},"MB/s",8,ls)],32)]),e("div",as,[e("div",ns,[e("div",is,[e("div",os,[e("small",rs,[t(n,{t:"Total Usage"})]),e("div",ds,u($(c.value.total.total_gb)),1),e("div",cs,[t(n,{t:"Sent"}),y(": "+u($(c.value.total.sent_gb))+" ",1),o[6]||(o[6]=e("span",{class:"mx-2"},"•",-1)),t(n,{t:"Received"}),y(": "+u($(c.value.total.receive_gb)),1)])])])]),e("div",us,[e("div",ms,[e("div",vs,[e("small",bs,[t(n,{t:"Today"}),e("span",gs,"("+u(c.value.daily.date)+")",1)]),e("div",_s,u($(c.value.daily.total_gb)),1),e("div",hs,[t(n,{t:"Sent"}),y(": "+u($(c.value.daily.sent_gb))+" ",1),o[7]||(o[7]=e("span",{class:"mx-2"},"•",-1)),t(n,{t:"Received"}),y(": "+u($(c.value.daily.receive_gb)),1)])])])]),e("div",fs,[e("div",ps,[e("div",xs,[e("small",ys,[t(n,{t:"Assigned Peers"})]),e("div",ks,u(c.value.peers_count),1),e("div",ws,[t(n,{t:"Updated"}),y(": "+u(c.value.generated_at),1)])])])]),e("div",Cs,[e("div",Ss,[e("div",Ps,[e("small",$s,[t(n,{t:"Realtime Speed"})]),e("div",As,u(T(s.value.recv_bps))+" ↓ ",1),e("div",Ds,u(T(s.value.sent_bps))+" ↑ ",1),e("div",Ns,[t(re,{recv:m.value.recv,sent:m.value.sent,width:160,height:34},null,8,["recv","sent"])]),e("div",Is,[t(n,{t:"Updated"}),y(": "+u(s.value.updated_at||"—"),1)])])])])]),c.value.tracking_disabled_configurations&&c.value.tracking_disabled_configurations.length?(l(),r("div",Ms,[e("small",null,[t(n,{t:"Traffic tracking disabled for"}),y(": "+u(c.value.tracking_disabled_configurations.join(", ")),1)])])):w("",!0)])):w("",!0),e("div",Rs,[t(Ve,{onRefresh:o[2]||(o[2]=I=>C()),clientAssignedPeers:a.value,client:i.value},null,8,["clientAssignedPeers","client"]),t(Ge,{onDeleteSuccess:o[3]||(o[3]=I=>se()),client:i.value},null,8,["client"])])])):(l(),r("div",Bs,[e("div",Us,[o[8]||(o[8]=e("h1",null,[e("i",{class:"bi bi-person-x"})],-1)),e("p",null,[t(n,{t:"Client does not exist"})])])]))}}}),Es=oe(js,[["__scopeId","data-v-c4caadc8"]]);export{Es as default};

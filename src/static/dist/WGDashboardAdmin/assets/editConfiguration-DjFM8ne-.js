import{_ as T,L as F,W as Y,o as K,K as q,D as U,r as y,M as G,c as h,f as v,a as e,b as s,q as C,A as $,n as B,B as W,t as P,j as X,a4 as ee,d as N,y as L,l as R,F as O,k as H,J as te,a5 as se,e as M,N as z,I as ne,x as Z,h as oe,i as le,g as I,u as J,s as ie,w as A,m as j,a6 as ae,T as Q,E as de,v as re}from"./index-Cf4jNNie.js";import{L as n}from"./localeText-BilYarrN.js";import{d as ue}from"./dayjs.min-zFrFwdFG.js";const ce={class:"card rounded-3 flex-grow-1 bg-danger-subtle border-danger-subtle border shadow"},me={class:"card-body"},fe={class:"d-flex align-items-center gap-3 inputGroup"},ge=["value"],be={class:"mb-0"},ve={class:"d-flex mt-3"},pe=["disabled"],he={__name:"updateConfigurationName",props:{configurationName:String},emits:["close"],setup(a,{emit:d}){const t=a,m=d,o=F({data:"",valid:!1}),f=Y();K(()=>{q(()=>o.data,b=>{o.valid=/^[a-zA-Z0-9_=+.-]{1,15}$/.test(b)&&b.length>0&&!f.Configurations.find(w=>w.Name===b)})});const u=U(),x=y(!1),c=G(),i=async()=>{o.data&&(x.value=!0,clearInterval(u.Peers.RefreshInterval),await W("/api/renameWireguardConfiguration",{ConfigurationName:t.configurationName,NewConfigurationName:o.data},async b=>{b.status?(await f.getConfigurations(),u.newMessage("Server","Configuration renamed","success"),c.push(`/configuration/${o.data}/peers`)):(u.newMessage("Server",b.message,"danger"),x.value=!1)}))};return(b,w)=>(v(),h("div",ce,[e("div",me,[e("p",null,[s(n,{t:"To update this configuration's name, WGDashboard will execute the following operations:"})]),e("ol",null,[e("li",null,[s(n,{t:"Duplicate current configuration's database table and .conf file with the new name"})]),e("li",null,[s(n,{t:"Delete current configuration's database table and .conf file"})])]),e("div",fe,[e("input",{class:"form-control form-control-sm rounded-3",value:a.configurationName,disabled:""},null,8,ge),w[3]||(w[3]=e("h3",{class:"mb-0"},[e("i",{class:"bi bi-arrow-right"})],-1)),C(e("input",{class:B(["form-control form-control-sm rounded-3",[o.data?o.valid?"is-valid":"is-invalid":""]]),id:"newConfigurationName","onUpdate:modelValue":w[0]||(w[0]=k=>o.data=k)},null,2),[[$,o.data]])]),e("div",{class:B(["invalid-feedback",{"d-block":!o.valid&&o.data}])},[s(n,{t:"Configuration name is invalid. Possible reasons:"}),e("ul",be,[e("li",null,[s(n,{t:"Configuration name already exist"})]),e("li",null,[s(n,{t:"Configuration name can only contain 15 lower/uppercase alphabet, numbers, underscore, equal sign, plus sign, period and hyphen."})])])],2),e("div",ve,[e("button",{onClick:w[1]||(w[1]=k=>m("close")),class:"btn btn-sm bg-secondary-subtle border-secondary-subtle text-secondary-emphasis rounded-3"},[s(n,{t:"Cancel"})]),e("button",{onClick:w[2]||(w[2]=k=>i()),disabled:!o.data||x.value,class:"btn btn-sm btn-danger rounded-3 ms-auto"},[s(n,{t:"Save"})],8,pe)])])]))}},ye=T(he,[["__scopeId","data-v-33ea9576"]]),xe={name:"Dropdown",props:{width:{type:String,default:"80px"},height:{type:String,default:"auto"},title:{type:String,default:""},disabled:{type:Boolean,default:!1},defaultDisplay:{type:Boolean,default:!1}}},_e={class:"title"};function we(a,d,t,m,o,f){return v(),h("div",{class:B(["dropdown",{disabled:t.disabled}]),onClick:d[0]||(d[0]=(...u)=>a.toggleDropdown&&a.toggleDropdown(...u)),onFocusout:d[1]||(d[1]=(...u)=>a.hideDropdown&&a.hideDropdown(...u)),tabindex:"0"},[e("div",_e,[e("div",null,P(t.title),1)])],34)}const ke=T(xe,[["render",we]]),Ce={components:{Dropdown:ke},name:"CodeEditor",props:{lineNums:{type:Boolean,default:!1},modelValue:{type:String},value:{type:String},theme:{type:String,default:"github-dark"},tabSpaces:{type:Number,default:2},wrap:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},header:{type:Boolean,default:!0},width:{type:String,default:"540px"},height:{type:String,default:"auto"},maxWidth:{type:String},minWidth:{type:String},maxHeight:{type:String},minHeight:{type:String},borderRadius:{type:String,default:"12px"},languages:{type:Array,default:function(){return[["javascript","JS"]]}},langListWidth:{type:String,default:"110px"},langListHeight:{type:String,default:"auto"},langListDisplay:{type:Boolean,default:!1},displayLanguage:{type:Boolean,default:!0},zIndex:{type:String,default:"0"},fontSize:{type:String,default:"17px"},padding:{type:String,default:"20px"}},directives:{highlight:{mounted(a,d){a.textContent=d.value},updated(a,d){a.scrolling?a.scrolling=!1:a.textContent=d.value}}},data(){return{scrollBarWidth:0,scrollBarHeight:0,top:0,left:0,languageClass:"hljs language-"+this.languages[0][0],languageTitle:this.languages[0][1]?this.languages[0][1]:this.languages[0][0],content:this.value,cursorPosition:0,insertTab:!1,lineNum:0,lineNumsWidth:0,scrolling:!1,textareaHeight:0,showLineNums:this.wrap?!1:this.lineNums}},computed:{tabWidth(){let a="";for(let d=0;d<this.tabSpaces;d++)a+=" ";return a},contentValue(){return this.modelValue==null?this.content+`
`:this.modelValue+`
`},scroll(){return this.height!="auto"}},methods:{updateValue(a){this.modelValue==null?this.content=a.target.value:this.$emit("update:modelValue",a.target.value)},changeLang(a){this.languageTitle=a[1]?a[1]:a[0],this.languageClass="language-"+a[0],this.$emit("lang",a[0])},tab(){if(document.execCommand("insertText"))document.execCommand("insertText",!1,this.tabWidth);else{const a=this.$refs.textarea.selectionStart;this.content=this.content.substring(0,a)+this.tabWidth+this.content.substring(a),this.cursorPosition=a+this.tabWidth.length,this.insertTab=!0}},calcScrollDistance(a){this.$refs.code.scrolling=!0,this.scrolling=!0,this.top=-a.target.scrollTop,this.left=-a.target.scrollLeft},resizer(){new ResizeObserver(t=>{this.scrollBarWidth=t[0].target.offsetWidth-t[0].target.clientWidth,this.scrollBarHeight=t[0].target.offsetHeight-t[0].target.clientHeight,this.textareaHeight=t[0].target.offsetHeight}).observe(this.$refs.textarea);const d=new ResizeObserver(t=>{this.lineNumsWidth=t[0].target.offsetWidth});this.$refs.lineNums&&d.observe(this.$refs.lineNums)},copy(){document.execCommand("copy")?(this.$refs.textarea.select(),document.execCommand("copy"),window.getSelection().removeAllRanges()):navigator.clipboard.writeText(this.$refs.textarea.value)},getLineNum(){const a=this.$refs.textarea.value;let d=0,t=a.indexOf(`
`);for(;t!==-1;)d++,t=a.indexOf(`
`,t+1);const m=this.$refs.lineNums.firstChild.offsetHeight,o=parseInt(this.textareaHeight/m)-1;this.lineNum=this.height=="auto"||d>o?d:o}},mounted(){this.$emit("lang",this.languages[0][0]),this.$emit("content",this.content),this.$emit("textarea",this.$refs.textarea),this.resizer()},updated(){this.insertTab&&(this.$refs.textarea.setSelectionRange(this.cursorPosition,this.cursorPosition),this.insertTab=!1),this.lineNums&&(this.scrolling?this.scrolling=!1:this.getLineNum())}},Se=["theme"],$e=["readOnly","autofocus","value"];function Ne(a,d,t,m,o,f){const u=X("Dropdown"),x=ee("highlight");return v(),h("div",{theme:t.theme,class:B(["code-editor",{"hide-header":!t.header,scroll:f.scroll,"read-only":t.readOnly,wrap:t.wrap}]),style:L({width:t.width,height:t.height,zIndex:t.zIndex,maxWidth:t.maxWidth,minWidth:t.minWidth,maxHeight:t.maxHeight,minHeight:t.minHeight})},[e("div",{class:"hljs",style:L({borderRadius:t.borderRadius})},[t.header?(v(),h("div",{key:0,class:B(["header",{border:o.showLineNums}]),style:L({borderRadius:t.borderRadius+" "+t.borderRadius+" 0 0"})},[t.displayLanguage?(v(),R(u,{key:0,width:t.langListWidth,title:o.languageTitle,disabled:t.languages.length<=1,defaultDisplay:t.langListDisplay},null,8,["width","title","disabled","defaultDisplay"])):N("",!0)],6)):N("",!0),e("div",{class:"code-area",style:L({borderRadius:t.header?"0 0 "+t.borderRadius+" "+t.borderRadius:t.borderRadius})},[o.showLineNums?(v(),h("div",{key:0,ref:"lineNums",class:"line-nums hljs",style:L({fontSize:t.fontSize,paddingTop:t.header?"10px":t.padding,paddingBottom:t.padding,top:o.top+"px"})},[d[3]||(d[3]=e("div",null,"1",-1)),(v(!0),h(O,null,H(o.lineNum,c=>(v(),h("div",null,P(c+1),1))),256)),d[4]||(d[4]=e("div",null,"Â ",-1))],4)):N("",!0),e("textarea",{title:"textarea",readOnly:t.readOnly,style:L({fontSize:t.fontSize,padding:t.header?t.lineNums?"10px "+t.padding+" "+t.padding:"0 "+t.padding+" "+t.padding:t.padding,marginLeft:o.showLineNums?o.lineNumsWidth+"px":"0",width:o.showLineNums?"calc(100% - "+o.lineNumsWidth+"px)":"100%"}),ref:"textarea",autofocus:t.autofocus,spellcheck:"false",onKeydown:d[0]||(d[0]=te(se((...c)=>f.tab&&f.tab(...c),["prevent","stop"]),["tab"])),onScroll:d[1]||(d[1]=(...c)=>f.calcScrollDistance&&f.calcScrollDistance(...c)),value:t.modelValue==null?o.content:t.modelValue,onInput:d[2]||(d[2]=(...c)=>f.updateValue&&f.updateValue(...c))},null,44,$e),e("pre",{style:L({paddingRight:o.scrollBarWidth+"px",paddingBottom:o.scrollBarHeight+"px",marginLeft:o.showLineNums?o.lineNumsWidth+"px":"0",width:o.showLineNums?"calc(100% - "+o.lineNumsWidth+"px)":"100%"})},[d[6]||(d[6]=M("        ",-1)),C((v(),h("code",{ref:"code",class:B(o.languageClass),style:L({top:o.top+"px",left:o.left+"px",fontSize:t.fontSize,padding:t.header?t.lineNums?"10px "+t.padding+" "+t.padding:"0 "+t.padding+" "+t.padding:t.padding})},[...d[5]||(d[5]=[M(`
        `,-1)])],6)),[[x,f.contentValue]]),d[7]||(d[7]=M(`
      `,-1))],4)],4)],4)],14,Se)}const Pe=T(Ce,[["render",Ne]]),Be={class:"peerSettingContainer w-100 h-100 position-absolute top-0 start-0 overflow-y-scroll"},Re={class:"container d-flex h-100 w-100"},De={class:"m-auto modal-dialog-centered dashboardModal",style:{width:"1000px"}},Le={class:"card rounded-3 shadow flex-grow-1",id:"deleteConfigurationContainer"},We={class:"card-header bg-transparent d-flex align-items-center gap-2 border-0 p-4 pb-0"},Ve={class:"mb-0"},Oe={class:"card-body px-4 d-flex flex-column gap-3"},Me={key:0,class:"alert alert-danger rounded-3 mb-0"},Ie={class:"mb-2"},Te={class:"bg-body w-100 p-2 rounded-3"},Ke={class:"d-flex gap-2"},Ue=["disabled"],He=["disabled"],Ae={__name:"editRawConfigurationFile",emits:["close"],async setup(a,{emit:d}){let t,m;const o=d,f=z(),u=y(""),x=y(""),c=y(!1),i=y(""),b=async()=>{await I("/api/getWireguardConfigurationRawFile",{configurationName:f.params.id},r=>{u.value=r.data.content,x.value=r.data.path})};[t,m]=ne(()=>b()),await t,m();const w=U(),k=y(!1),S=Z(()=>oe(w.Configuration.Server.dashboard_theme)==="dark"?"github-dark":"github");K(()=>{le()});const g=async()=>{k.value=!0,await W("/api/updateWireguardConfigurationRawFile",{configurationName:f.params.id,rawConfiguration:u.value},r=>{r.status?(c.value=!1,w.newMessage("Server","Configuration saved","success")):(c.value=!0,i.value=r.message),k.value=!1})};return(r,_)=>(v(),h("div",Be,[e("div",Re,[e("div",De,[e("div",Le,[e("div",We,[e("h5",Ve,[s(n,{t:"Edit Raw Configuration File"})]),e("button",{type:"button",class:"btn-close ms-auto",onClick:_[0]||(_[0]=D=>o("close"))})]),e("div",Oe,[c.value?(v(),h("div",Me,[e("div",Ie,[e("strong",null,[s(n,{t:"Failed to save configuration. Please see the following error message:"})])]),e("div",Te,[e("pre",null,P(i.value),1)])])):N("",!0),s(Pe,{disabled:!0,"read-only":k.value,modelValue:u.value,"onUpdate:modelValue":_[1]||(_[1]=D=>u.value=D),theme:S.value,languages:[["ini",x.value]],width:"100%",height:"600px"},null,8,["read-only","modelValue","theme","languages"]),e("div",Ke,[e("button",{class:"btn bg-secondary-subtle border-secondary-subtle text-secondary-emphasis rounded-3 shadow ms-auto px-3 py-2",disabled:k.value,onClick:_[2]||(_[2]=D=>b())},[_[4]||(_[4]=e("i",{class:"bi bi-arrow-clockwise me-2"},null,-1)),s(n,{t:"Reset"})],8,Ue),e("button",{onClick:_[3]||(_[3]=D=>g()),disabled:k.value,class:"btn bg-danger-subtle border-danger-subtle text-danger-emphasis rounded-3 px-3 py-2 shadow"},[_[5]||(_[5]=e("i",{class:"bi bi-save-fill me-2"},null,-1)),k.value?(v(),R(n,{key:1,t:"Saving..."})):(v(),R(n,{key:0,t:"Save"}))],8,He)])])])])])]))}},ze={class:"peerSettingContainer w-100 h-100 position-absolute top-0 start-0 overflow-y-scroll"},Ee={class:"container d-flex h-100 w-100"},Fe={class:"m-auto modal-dialog-centered dashboardModal",style:{width:"700px"}},Je={class:"card rounded-3 shadow flex-grow-1 bg-danger-subtle border-danger-subtle",id:"deleteConfigurationContainer"},je={class:"card-header bg-transparent d-flex align-items-center gap-2 border-0 p-4 pb-0"},Ye={class:"mb-0"},qe={class:"card-body px-4 text-muted"},Ge={class:"mb-0"},Ze={key:0},Qe={key:1},Xe={key:2,class:"d-flex align-items-center gap-2"},et=["placeholder"],tt=["disabled"],st={__name:"deleteConfiguration",emits:["backup","close"],setup(a,{emit:d}){const m=z().params.id,o=y(""),f=G(),u=U(),x=y(!1),c=()=>{clearInterval(u.Peers.RefreshInterval),x.value=!0,W("/api/deleteWireguardConfiguration",{ConfigurationName:m},S=>{S.status?(f.push("/"),u.newMessage("Server","Configuration deleted","success")):x.value=!1})},i=y(!0),b=y([]),w=()=>{i.value=!0,I("/api/getWireguardConfigurationBackup",{configurationName:m},S=>{b.value=S.data,i.value=!1})};K(()=>{w()});const k=d;return(S,g)=>(v(),h("div",ze,[e("div",Ee,[e("div",Fe,[e("div",Je,[e("div",je,[e("h5",Ye,[s(n,{t:"Are you sure to delete this configuration?"})]),e("button",{type:"button",class:"btn-close ms-auto",onClick:g[0]||(g[0]=r=>k("close"))})]),e("div",qe,[e("p",Ge,[s(n,{t:"Once you deleted this configuration:"})]),e("ul",null,[e("li",null,[s(n,{t:"All connected peers will get disconnected"})]),e("li",null,[s(n,{t:"Both configuration file (.conf) and database table related to this configuration will get deleted"})])]),e("div",{class:B(["alert",[i.value?"alert-secondary":b.value.length>0?"alert-success":"alert-danger"]])},[i.value?(v(),h("div",Ze,[g[5]||(g[5]=e("i",{class:"bi bi-search me-2"},null,-1)),s(n,{t:"Checking backups..."})])):b.value.length>0?(v(),h("div",Qe,[g[6]||(g[6]=e("i",{class:"bi bi-check-circle-fill me-2"},null,-1)),s(n,{t:"This configuration has "+b.value.length+" backups"},null,8,["t"])])):(v(),h("div",Xe,[g[9]||(g[9]=e("i",{class:"bi bi-x-circle-fill me-2"},null,-1)),s(n,{t:"This configuration has no backup"}),e("a",{role:"button",onClick:g[1]||(g[1]=r=>k("backup")),class:"ms-auto btn btn-sm btn-primary rounded-3"},[g[7]||(g[7]=e("i",{class:"bi bi-clock-history me-2"},null,-1)),s(n,{t:"Backup"})]),e("a",{role:"button",onClick:g[2]||(g[2]=r=>w()),class:"btn btn-sm btn-primary rounded-3"},[...g[8]||(g[8]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1)])])]))],2),g[11]||(g[11]=e("hr",null,null,-1)),e("p",null,[s(n,{t:"If you're sure, please type in the configuration name below and click Delete"})]),C(e("input",{class:"form-control rounded-3 mb-3",placeholder:J(m),"onUpdate:modelValue":g[3]||(g[3]=r=>o.value=r),type:"text"},null,8,et),[[$,o.value]]),e("button",{class:"btn btn-danger w-100",onClick:g[4]||(g[4]=r=>c()),disabled:o.value!==J(m)||x.value},[g[10]||(g[10]=e("i",{class:"bi bi-trash-fill me-2 rounded-3"},null,-1)),x.value?(v(),R(n,{key:1,t:"Deleting..."})):(v(),R(n,{key:0,t:"Delete"}))],8,tt)])])])])]))}},nt={class:"card my-0 rounded-3"},ot={class:"card-body position-relative"},lt={key:0,class:"position-absolute w-100 h-100 confirmationContainer start-0 top-0 rounded-3 d-flex p-2"},it={class:"m-auto"},at={class:"d-flex gap-2 align-items-center justify-content-center"},dt=["disabled"],rt=["disabled"],ut={key:0,class:"position-absolute w-100 h-100 confirmationContainer start-0 top-0 rounded-3 d-flex p-2"},ct={class:"m-auto"},mt={class:"d-flex gap-2 align-items-center justify-content-center"},ft=["disabled"],gt=["disabled"],bt={class:"d-flex gap-3"},vt={class:"d-flex flex-column"},pt={class:"text-muted"},ht={class:"d-flex flex-column"},yt={class:"text-muted"},xt={class:"d-flex gap-2 align-items-center ms-auto"},_t={class:"card rounded-3"},wt={key:0,class:"card-body"},kt=["value"],Ct={class:"d-flex"},St={__name:"backup",props:["b","delay"],emits:["refresh","refreshPeersList"],setup(a,{emit:d}){ie(g=>({v2dd0b691:k.value}));const t=a,m=y(!1),o=y(!1),f=z(),u=d,x=U(),c=y(!1),i=()=>{c.value=!0,W("/api/deleteWireguardConfigurationBackup",{ConfigurationName:f.params.id,BackupFileName:t.b.filename},g=>{c.value=!1,g.status?(u("refresh"),x.newMessage("Server","Backup deleted","success")):x.newMessage("Server","Backup failed to delete","danger")})},b=()=>{c.value=!0,W("/api/restoreWireguardConfigurationBackup",{ConfigurationName:f.params.id,BackupFileName:t.b.filename},g=>{c.value=!1,o.value=!1,g.status?(u("refreshPeersList"),x.newMessage("Server","Backup restored with "+t.b.filename,"success")):x.newMessage("Server","Backup failed to restore","danger")})},w=()=>{I("/api/downloadWireguardConfigurationBackup",{configurationName:f.params.id,backupFileName:t.b.filename},g=>{g.status&&window.open(ae(`/fileDownload?file=${g.data}`),"_blank")})},k=Z(()=>t.delay+"s"),S=y(!1);return(g,r)=>(v(),h("div",nt,[e("div",ot,[s(j,{name:"zoomReversed"},{default:A(()=>[m.value?(v(),h("div",lt,[e("div",it,[e("h5",null,[s(n,{t:"Are you sure to delete this backup?"})]),e("div",at,[e("button",{class:"btn btn-danger rounded-3",disabled:c.value,onClick:r[0]||(r[0]=_=>i())},[s(n,{t:"Yes"})],8,dt),e("button",{onClick:r[1]||(r[1]=_=>m.value=!1),disabled:c.value,class:"btn bg-secondary-subtle text-secondary-emphasis border-secondary-subtle rounded-3"},[s(n,{t:"No"})],8,rt)])])])):N("",!0)]),_:1}),s(j,{name:"zoomReversed"},{default:A(()=>[o.value?(v(),h("div",ut,[e("div",ct,[e("h5",null,[s(n,{t:"Are you sure to restore this backup?"})]),e("div",mt,[e("button",{disabled:c.value,onClick:r[2]||(r[2]=_=>b()),class:"btn btn-success rounded-3"},[s(n,{t:"Yes"})],8,ft),e("button",{onClick:r[3]||(r[3]=_=>o.value=!1),disabled:c.value,class:"btn bg-secondary-subtle text-secondary-emphasis border-secondary-subtle rounded-3"},[s(n,{t:"No"})],8,gt)])])])):N("",!0)]),_:1}),e("div",bt,[e("div",vt,[e("small",pt,[s(n,{t:"Backup"})]),e("samp",null,P(a.b.filename),1)]),e("div",ht,[e("small",yt,[s(n,{t:"Backup Date"})]),M(" "+P(J(ue)(a.b.backupDate,"YYYYMMDDHHmmss").format("YYYY-MM-DD HH:mm:ss")),1)]),e("div",xt,[e("button",{onClick:r[4]||(r[4]=_=>w()),class:"btn bg-primary-subtle text-primary-emphasis border-primary-subtle rounded-3 btn-sm"},[...r[8]||(r[8]=[e("i",{class:"bi bi-download"},null,-1)])]),e("button",{onClick:r[5]||(r[5]=_=>o.value=!0),class:"btn bg-warning-subtle text-warning-emphasis border-warning-subtle rounded-3 btn-sm"},[...r[9]||(r[9]=[e("i",{class:"bi bi-clock-history"},null,-1)])]),e("button",{onClick:r[6]||(r[6]=_=>m.value=!0),class:"btn bg-danger-subtle text-danger-emphasis border-danger-subtle rounded-3 btn-sm"},[...r[10]||(r[10]=[e("i",{class:"bi bi-trash-fill"},null,-1)])])])]),r[14]||(r[14]=e("hr",null,null,-1)),e("div",_t,[e("a",{role:"button",class:B(["card-header d-flex text-decoration-none align-items-center",{"border-bottom-0":!S.value}]),style:{cursor:"pointer"},onClick:r[7]||(r[7]=_=>S.value=!S.value)},[e("small",null,[r[11]||(r[11]=M(".conf ",-1)),s(n,{t:"File"})]),r[12]||(r[12]=e("i",{class:"bi bi-chevron-down ms-auto"},null,-1))],2),S.value?(v(),h("div",wt,[e("textarea",{class:"form-control rounded-3",value:a.b.content,disabled:"",style:{height:"300px","font-family":"var(--bs-font-monospace),sans-serif !important"}},null,8,kt)])):N("",!0)]),r[15]||(r[15]=e("hr",null,null,-1)),e("div",Ct,[e("span",null,[r[13]||(r[13]=e("i",{class:"bi bi-database me-1"},null,-1)),s(n,{t:"Database File"})]),e("i",{class:B(["bi ms-auto",[a.b.database?"text-success bi-check-circle-fill":"text-danger bi-x-circle-fill"]])},null,2)])])]))}},$t=T(St,[["__scopeId","data-v-c65cdc10"]]),Nt={class:"peerSettingContainer w-100 h-100 position-absolute top-0 start-0 overflow-y-scroll",ref:"editConfigurationContainer"},Pt={class:"d-flex h-100 w-100"},Bt={class:"modal-dialog-centered dashboardModal w-100 h-100 overflow-x-scroll flex-column gap-3 mx-3"},Rt={class:"my-5 d-flex gap-3 flex-column position-relative"},Dt={class:"title"},Lt={class:"d-flex mb-3"},Wt={class:"mb-0"},Vt={class:"position-relative d-flex flex-column gap-3"},Ot={class:"text-center title",key:"spinner"},Mt={class:"card my-0 rounded-3",key:"noBackups"},It={class:"card-body text-center text-muted"},Tt={__name:"configurationBackupRestore",emits:["close","refreshPeersList"],setup(a,{emit:d}){const t=z(),m=y([]),o=y(!0),f=d;K(()=>{u()});const u=()=>{o.value=!0,I("/api/getWireguardConfigurationBackup",{configurationName:t.params.id},c=>{m.value=c.data,o.value=!1})},x=()=>{I("/api/createWireguardConfigurationBackup",{configurationName:t.params.id},c=>{m.value=c.data,o.value=!1})};return(c,i)=>(v(),h("div",Nt,[e("div",Pt,[e("div",Bt,[e("div",Rt,[e("div",Dt,[e("div",Lt,[e("h4",Wt,[s(n,{t:"Backup & Restore"})]),e("button",{type:"button",class:"btn-close ms-auto",onClick:i[0]||(i[0]=b=>c.$emit("close"))})]),e("button",{onClick:i[1]||(i[1]=b=>x()),class:"btn bg-primary-subtle text-primary-emphasis border-primary-subtle rounded-3 w-100"},[i[4]||(i[4]=e("i",{class:"bi bi-plus-circle-fill me-2"},null,-1)),s(n,{t:"Create Backup"})])]),e("div",Vt,[s(Q,{name:"list1"},{default:A(()=>[o.value&&m.value.length===0?(v(),h("div",Ot,[...i[5]||(i[5]=[e("div",{class:"spinner-border"},null,-1)])])):!o.value&&m.value.length===0?(v(),h("div",Mt,[e("div",It,[i[6]||(i[6]=e("i",{class:"bi bi-x-circle-fill me-2"},null,-1)),s(n,{t:"No backup yet, click the button above to create backup."})])])):N("",!0),(v(!0),h(O,null,H(m.value,b=>(v(),R($t,{onRefresh:i[2]||(i[2]=w=>u()),onRefreshPeersList:i[3]||(i[3]=w=>f("refreshPeersList")),b,key:b.filename},null,8,["b"]))),128))]),_:1})])])])])],512))}},Kt=T(Tt,[["__scopeId","data-v-1f718118"]]),Ut={id:"editPeerSettingsOverride"},Ht={class:"mb-0"},At={class:"mb-3 text-muted"},zt={class:"d-flex gap-2 flex-column"},Et={for:"override_DNS",class:"form-label"},Ft={class:"text-muted"},Jt=["disabled"],jt={class:"invalid-feedback"},Yt={for:"override_EndpointAllowedIPs",class:"form-label"},qt={class:"text-muted"},Gt=["disabled"],Zt={class:"invalid-feedback"},Qt={for:"override_ListenPort",class:"form-label"},Xt={class:"text-muted"},es=["disabled"],ts={class:"invalid-feedback"},ss={for:"override_MTU",class:"form-label"},ns={class:"text-muted"},os=["disabled"],ls={class:"invalid-feedback"},is={for:"override_PeerRemoteEndpoint",class:"form-label"},as={class:"text-muted"},ds=["disabled"],rs={for:"override_persistent_keepalive",class:"form-label"},us={class:"text-muted"},cs=["disabled"],ms={class:"invalid-feedback"},fs={class:"d-flex mt-1 gap-2"},gs=de({__name:"editPeerSettingsOverride",props:["configuration"],setup(a){const d=a,t=y(!1),m=y({...d.configuration.Info.OverridePeerSettings}),o=y(!1),f=y("");K(()=>{document.querySelectorAll("#editPeerSettingsOverride input").forEach(c=>c.addEventListener("change",()=>{o.value=!0}))});const u=()=>{m.value=d.configuration.Info.OverridePeerSettings,o.value=!1},x=async()=>{document.querySelectorAll("#editPeerSettingsOverride input").forEach(c=>c.classList.remove("is-invalid","is-valid")),await W("/api/updateWireguardConfigurationInfo",{Name:d.configuration.Name,Key:"OverridePeerSettings",Value:m.value},c=>{c.status?(o.value=!1,d.configuration.Info.OverridePeerSettings=m.value,document.querySelectorAll("#editPeerSettingsOverride input").forEach(i=>i.classList.add("is-valid"))):(f.value=c.message,document.querySelector(`#override_${c.data}`).classList.add("is-invalid"))})};return(c,i)=>(v(),h("div",Ut,[e("h5",Ht,[s(n,{t:"Override Peer Settings"})]),e("h6",At,[e("small",null,[s(n,{t:"Only apply to peers in this configuration"})])]),e("div",zt,[e("div",null,[e("label",Et,[e("small",Ft,[s(n,{t:"DNS"})])]),C(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:t.value,"onUpdate:modelValue":i[0]||(i[0]=b=>m.value.DNS=b),id:"override_DNS"},null,8,Jt),[[$,m.value.DNS]]),e("div",jt,P(f.value),1)]),e("div",null,[e("label",Yt,[e("small",qt,[s(n,{t:"Endpoint Allowed IPs"})])]),C(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:t.value,"onUpdate:modelValue":i[1]||(i[1]=b=>m.value.EndpointAllowedIPs=b),id:"override_EndpointAllowedIPs"},null,8,Gt),[[$,m.value.EndpointAllowedIPs]]),e("div",Zt,P(f.value),1)]),e("div",null,[e("label",Qt,[e("small",Xt,[s(n,{t:"Listen Port"})])]),C(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:t.value,"onUpdate:modelValue":i[2]||(i[2]=b=>m.value.ListenPort=b),id:"override_ListenPort"},null,8,es),[[$,m.value.ListenPort]]),e("div",ts,P(f.value),1)]),e("div",null,[e("label",ss,[e("small",ns,[s(n,{t:"MTU"})])]),C(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:t.value,"onUpdate:modelValue":i[3]||(i[3]=b=>m.value.MTU=b),id:"override_MTU"},null,8,os),[[$,m.value.MTU]]),e("div",ls,P(f.value),1)]),e("div",null,[e("label",is,[e("small",as,[s(n,{t:"Peer Remote Endpoint"})])]),C(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:t.value,"onUpdate:modelValue":i[4]||(i[4]=b=>m.value.PeerRemoteEndpoint=b),id:"override_PeerRemoteEndpoint"},null,8,ds),[[$,m.value.PeerRemoteEndpoint]])]),e("div",null,[e("label",rs,[e("small",us,[s(n,{t:"Persistent Keepalive"})])]),C(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:t.value,"onUpdate:modelValue":i[5]||(i[5]=b=>m.value.PersistentKeepalive=b),id:"override_PersistentKeepalive"},null,8,cs),[[$,m.value.PersistentKeepalive]]),e("div",ms,P(f.value),1)]),e("div",fs,[e("button",{class:B([{disabled:!o.value},"btn btn-sm bg-secondary-subtle border-secondary-subtle text-secondary-emphasis rounded-3 shadow ms-auto"]),onClick:i[6]||(i[6]=b=>u())},[i[8]||(i[8]=e("i",{class:"bi bi-arrow-clockwise me-2"},null,-1)),s(n,{t:"Reset"})],2),e("button",{class:B([{disabled:!o.value},"btn btn-sm bg-primary-subtle border-primary-subtle text-primary-emphasis rounded-3 shadow"]),onClick:i[7]||(i[7]=b=>x())},[i[9]||(i[9]=e("i",{class:"bi bi-save-fill me-2"},null,-1)),s(n,{t:"Save"})],2)])])]))}}),bs={class:"peerSettingContainer w-100 h-100 position-absolute top-0 start-0",ref:"editConfigurationContainer"},vs={class:"w-100 h-100 overflow-y-scroll"},ps={class:"container d-flex h-100 w-100"},hs={class:"m-auto modal-dialog-centered dashboardModal",style:{width:"700px"}},ys={class:"card rounded-3 shadow flex-grow-1"},xs={class:"card-header bg-transparent d-flex align-items-center gap-2 border-0 p-4"},_s={class:"mb-0"},ws={class:"card-body px-4 pb-4"},ks={class:"d-flex gap-2 flex-column"},Cs={key:0,class:"d-flex align-items-center gap-3"},Ss={class:"text-muted"},$s={class:"d-flex align-items-center gap-3"},Ns={class:"text-muted",style:{"word-break":"keep-all"}},Ps={class:"ms-auto",style:{"word-break":"break-all"}},Bs={class:"d-flex"},Rs={for:"configuration_private_key",class:"form-label"},Ds={class:"text-muted d-block"},Ls={class:"form-check form-switch ms-auto"},Ws=["disabled"],Vs={for:"configuration_ipaddress_cidr",class:"form-label"},Os={class:"text-muted"},Ms=["disabled"],Is={for:"configuration_listen_port",class:"form-label"},Ts={class:"text-muted"},Ks=["disabled"],Us={class:"accordion mt-2",id:"editConfigurationOptionalAccordion"},Hs={class:"accordion-item"},As={class:"accordion-header"},zs={class:"accordion-button collapsed px-3 py-2",type:"button","data-bs-toggle":"collapse","data-bs-target":"#editOptionalAccordionCollapse"},Es={class:"text-muted"},Fs={id:"editOptionalAccordionCollapse",class:"accordion-collapse collapse","data-bs-parent":"#editConfigurationOptionalAccordion"},Js={class:"accordion-body d-flex flex-column gap-3"},js=["for"],Ys={class:"text-muted"},qs=["disabled","onUpdate:modelValue","id"],Gs=["for"],Zs={class:"text-muted"},Qs=["disabled","onUpdate:modelValue","id"],Xs={class:"d-flex align-items-center gap-2 mt-1"},en=["disabled"],tn=["disabled"],sn={class:"mb-3"},nn={class:"d-flex gap-2 flex-column"},dn={__name:"editConfiguration",props:{configurationInfo:Object},emits:["changed","close","refresh","dataChanged"],setup(a,{emit:d}){const t=a,m=Y(),o=U(),f=y(!1),u=F(JSON.parse(JSON.stringify(t.configurationInfo))),x=y(!1),c=y(!1),i=F({PrivateKey:!0,IPAddress:!0,ListenPort:!0}),b=()=>{m.checkWGKeyLength(u.PrivateKey)?(i.PrivateKey=!0,u.PublicKey=window.wireguard.generatePublicKey(u.PrivateKey)):i.PrivateKey=!1},w=()=>{c.value=!1,Object.assign(u,JSON.parse(JSON.stringify(t.configurationInfo)))},k=d,S=()=>{f.value=!0,W("/api/updateWireguardConfiguration",u,V=>{f.value=!1,V.status?(o.newMessage("Server","Configuration saved","success"),c.value=!1,k("dataChanged",V.data)):o.newMessage("Server",V.message,"danger")})},g=y(!1);q(u,()=>{c.value=JSON.stringify(u)!==JSON.stringify(t.configurationInfo)},{deep:!0});const r=y(!1),_=y(!1),D=y(!1);return(V,l)=>(v(),h("div",bs,[e("div",vs,[s(Q,{name:"zoom"},{default:A(()=>[r.value?(v(),R(Ae,{key:0,name:"EditRawConfigurationFile",onClose:l[0]||(l[0]=p=>r.value=!1)})):N("",!0),D.value?(v(),R(st,{key:"DeleteConfiguration",onBackup:l[1]||(l[1]=p=>_.value=!0),onClose:l[2]||(l[2]=p=>D.value=!1)})):N("",!0),_.value?(v(),R(Kt,{key:2,onClose:l[3]||(l[3]=p=>_.value=!1),onRefreshPeersList:l[4]||(l[4]=p=>k("refresh"))})):N("",!0)]),_:1}),e("div",ps,[e("div",hs,[e("div",ys,[e("div",xs,[e("h4",_s,[s(n,{t:"Configuration Settings"})]),e("button",{type:"button",class:"btn-close ms-auto",onClick:l[5]||(l[5]=p=>V.$emit("close"))})]),e("div",ws,[e("div",ks,[g.value?N("",!0):(v(),h("div",Cs,[e("small",Ss,[s(n,{t:"Name"})]),e("small",null,P(u.Name),1),e("button",{onClick:l[6]||(l[6]=p=>g.value=!0),class:"btn btn-sm bg-danger-subtle border-danger-subtle text-danger-emphasis rounded-3 ms-auto"},[s(n,{t:"Update Name"})])])),g.value?(v(),R(ye,{key:1,onClose:l[7]||(l[7]=p=>g.value=!1),"configuration-name":u.Name},null,8,["configuration-name"])):(v(),h(O,{key:2},[l[24]||(l[24]=e("hr",null,null,-1)),e("div",$s,[e("small",Ns,[s(n,{t:"Public Key"})]),e("small",Ps,P(u.PublicKey),1)]),l[25]||(l[25]=e("hr",null,null,-1)),e("div",null,[e("div",Bs,[e("label",Rs,[e("small",Ds,[s(n,{t:"Private Key"})])]),e("div",Ls,[C(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"editPrivateKeySwitch","onUpdate:modelValue":l[8]||(l[8]=p=>x.value=p)},null,512),[[re,x.value]]),l[18]||(l[18]=e("label",{class:"form-check-label",for:"editPrivateKeySwitch"},[e("small",null,"Edit")],-1))])]),C(e("input",{type:"text",class:B(["form-control form-control-sm rounded-3",{"is-invalid":!i.PrivateKey}]),disabled:f.value||!x.value,onKeyup:l[9]||(l[9]=p=>b()),"onUpdate:modelValue":l[10]||(l[10]=p=>u.PrivateKey=p),id:"configuration_private_key"},null,42,Ws),[[$,u.PrivateKey]])]),e("div",null,[e("label",Vs,[e("small",Os,[s(n,{t:"IP Address/CIDR"})])]),C(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:f.value,"onUpdate:modelValue":l[11]||(l[11]=p=>u.Address=p),id:"configuration_ipaddress_cidr"},null,8,Ms),[[$,u.Address]])]),e("div",null,[e("label",Is,[e("small",Ts,[s(n,{t:"Listen Port"})])]),C(e("input",{type:"number",class:"form-control form-control-sm rounded-3",disabled:f.value,"onUpdate:modelValue":l[12]||(l[12]=p=>u.ListenPort=p),id:"configuration_listen_port"},null,8,Ks),[[$,u.ListenPort]])]),e("div",Us,[e("div",Hs,[e("h2",As,[e("button",zs,[e("small",Es,[s(n,{t:"Optional Settings"})])])]),e("div",Fs,[e("div",Js,[(v(),h(O,null,H(["Table","PreUp","PreDown","PostUp","PostDown"],p=>e("div",null,[e("label",{for:"configuration_"+p,class:"form-label"},[e("small",Ys,[s(n,{t:p},null,8,["t"])])],8,js),C(e("input",{type:"text",class:"form-control form-control-sm rounded-3",disabled:f.value,"onUpdate:modelValue":E=>u[p]=E,id:"configuration_"+p},null,8,qs),[[$,u[p]]])])),64)),a.configurationInfo.Protocol==="awg"?(v(),h(O,{key:0},H(["Jc","Jmin","Jmax","S1","S2","H1","H2","H3","H4"],p=>e("div",null,[e("label",{for:"configuration_"+p,class:"form-label"},[e("small",Zs,[s(n,{t:p},null,8,["t"])])],8,Gs),C(e("input",{type:"number",class:"form-control form-control-sm rounded-3",disabled:f.value,"onUpdate:modelValue":E=>u[p]=E,id:"configuration_"+p},null,8,Qs),[[$,u[p]]])])),64)):N("",!0)])])])]),e("div",Xs,[e("button",{class:"btn btn-sm bg-secondary-subtle border-secondary-subtle text-secondary-emphasis rounded-3 shadow ms-auto",onClick:l[13]||(l[13]=p=>w()),disabled:!c.value||f.value},[l[19]||(l[19]=e("i",{class:"bi bi-arrow-clockwise me-2"},null,-1)),s(n,{t:"Reset"})],8,en),e("button",{class:"btn btn-sm bg-primary-subtle border-primary-subtle text-primary-emphasis rounded-3 shadow",disabled:!c.value||f.value,onClick:l[14]||(l[14]=p=>S())},[l[20]||(l[20]=e("i",{class:"bi bi-save-fill me-2"},null,-1)),s(n,{t:"Save"})],8,tn)]),l[26]||(l[26]=e("hr",null,null,-1)),s(gs,{configuration:a.configurationInfo},null,8,["configuration"]),l[27]||(l[27]=e("hr",null,null,-1)),e("h5",sn,[s(n,{t:"Danger Zone"})]),e("div",nn,[e("button",{onClick:l[15]||(l[15]=p=>_.value=!0),class:"btn bg-warning-subtle border-warning-subtle text-warning-emphasis rounded-3 text-start d-flex"},[l[21]||(l[21]=e("i",{class:"bi bi-copy me-auto"},null,-1)),s(n,{t:"Backup & Restore"})]),e("button",{onClick:l[16]||(l[16]=p=>r.value=!0),class:"btn bg-warning-subtle border-warning-subtle text-warning-emphasis rounded-3 d-flex"},[l[22]||(l[22]=e("i",{class:"bi bi-pen me-auto"},null,-1)),s(n,{t:"Edit Raw Configuration File"})]),e("button",{onClick:l[17]||(l[17]=p=>D.value=!0),class:"btn bg-danger-subtle border-danger-subtle text-danger-emphasis rounded-3 d-flex mt-4"},[l[23]||(l[23]=e("i",{class:"bi bi-trash-fill me-auto"},null,-1)),s(n,{t:"Delete Configuration"})])])],64))])])])])])])],512))}};export{dn as default};
